//>>built
require({cache:{"epi-ecf-ui/layers/epi-ecf-ui-widgets":function(){define(["../CommerceUIModule","../contentediting/editors/AssociationCollectionReadOnlyEditor","../contentediting/editors/AssociationGroupSelectionEditor","../widget/CatalogContentDetails","../component/CatalogNavigationTree","../contentediting/editors/CategoryCollectionReadOnlyEditor","../contentediting/editors/VariantCollectionReadOnlyEditor","../contentediting/editors/BundleEntryCollectionReadOnlyEditor","../contentediting/editors/PackageEntryCollectionReadOnlyEditor","../contentediting/editors/CommerceMediaCollectionEditor","../widget/overlay/CommerceMediaCollection","../contentediting/editors/InventoryCollectionEditor","../contentediting/editors/PriceCollectionReadOnlyEditor","../widget/CatalogContentList","../widget/CatalogList","../widget/CommandButton","../widget/LinkEdit","../widget/VariantEdit","../widget/BundleEdit","../widget/PackageEdit","../component/Catalogs","../component/PricingOverview"],1);},"epi-ecf-ui/CommerceUIModule":function(){define("epi-ecf-ui/CommerceUIModule",["dojo/_base/declare","epi/_Module","epi/routes","epi/dependency","epi-cms/store/CustomQueryEngine"],function(_1,_2,_3,_4,_5){return _1([_2],{_settings:null,constructor:function(_6){this._settings=_6;},initialize:function(){this.inherited(arguments);this._initializeStores();},_initializeStores:function(){var _7=this.resolveDependency("epi.storeregistry");_7.create("epi.commerce.market",this._getRestPath("market"),{});_7.create("epi.commerce.price",this._getRestPath("price"),{queryEngine:_5});_7.create("epi.commerce.inventory",this._getRestPath("inventory"),{});_7.create("epi.commerce.relation",this._getRestPath("relation"),{queryEngine:_5});_7.create("epi.commerce.association",this._getRestPath("association"),{queryEngine:_5});_7.create("epi.commerce.customergroup",this._getRestPath("customergroup"),{});_7.create("epi.commerce.associationgroupdefinition",this._getRestPath("associationgroupdefinition"),{});_7.create("epi.commerce.relationgroupdefinition",this._getRestPath("relationgroupdefinition"),{});},_getRestPath:function(_8){return _3.getRestPath({moduleArea:"EPiServer.Commerce.AddOns.UI",storeName:_8});}});});},"epi-ecf-ui/contentediting/editors/AssociationCollectionReadOnlyEditor":function(){define(["dojo/_base/declare","./ReadOnlyCollectionEditor","../viewmodel/AssociationCollectionReadOnlyEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.associationcollectioneditor"],function(_9,_a,_b,_c){return _9([_a],{_renderNoDataMessage:function(){this.grid.set("noDataMessage",_c.nodatamessage);this.inherited(arguments);},iconClass:"epi-iconReferences",modelType:_b,changeToView:"linksview",buttonLabel:_c.editbuttontext});});},"epi-ecf-ui/contentediting/editors/ReadOnlyCollectionEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dijit/form/Button","epi-cms/contentediting/editors/CollectionEditor"],function(_d,_e,_f,_10,_11,_12){return _d([_12],{changeToView:null,buttonLabel:null,buttonClass:"epi-chromelessButton epi-visibleLink",iconClass:null,isLanguageSpecific:false,isInMasterLanguage:false,isLinkButtonCreated:false,modelBindingMap:{"isInMasterLanguage":["isInMasterLanguage"]},_setupGrid:function(){this.inherited(arguments);this.grid.set("selectionMode","none");},_getGridDefinition:function(){var _13=this.inherited(arguments);var _14=_13["contentTypeIdentifier"];if(_14){_14.className="epi-columnIcon16x16";_14.label="";}return _13;},postCreate:function(){this.inherited(arguments);},_setIsInMasterLanguageAttr:function(_15){this._set("isInMasterLanguage",_15);if(this.buttonLabel&&!this.get("isLinkButtonCreated")&&(this.isLanguageSpecific||_15)){this.createButton();}},createButton:function(){var _16=new _11({label:this.buttonLabel,iconClass:this.iconClass,"class":this.buttonClass,onClick:_e.hitch(this,function(){_10.publish("/epi/shell/action/changeview",this.changeToView,{},{});})});this.set("isLinkButtonCreated",true);this.own(_16);this.domNode.appendChild(_16.domNode);}});});},"epi-ecf-ui/contentediting/viewmodel/AssociationCollectionReadOnlyEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","./ReadOnlyCollectionEditorModel"],function(_17,_18,_19){return _17([_19],{_storeKey:"epi.commerce.association"});});},"epi-ecf-ui/contentediting/viewmodel/ReadOnlyCollectionEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/dgrid/formatters","epi-cms/contentediting/editors/model/CollectionEditorModel"],function(_1a,_1b,_1c,_1d,_1e,_1f){return _1a([_1f],{_storeKey:null,_store:null,_contentStructureStore:null,_contentLink:null,isInMasterLanguage:null,postscript:function(){var _20=_1d.resolve("epi.storeregistry");this._store=this._store||_20.get(this._storeKey);this._contentStructureStore=this._contentStructureStore||_20.get("epi.cms.content.light");this.inherited(arguments);},_dataSetter:function(_21){this._contentLink=_21;if(!_21){this.data=_21;this._initData();return;}_1c(this._store.query(this.createQuery(_21)),_1b.hitch(this,function(_22){if(_22.models){this.data=_22.models;}else{this.data=_22;}this._initData();}));_1c(this.getCurrentContent(),_1b.hitch(this,function(_23){this.set("isInMasterLanguage",_23.currentLanguageBranch.isMasterLanguage);}));},_dataGetter:function(){return this._contentLink;},createQuery:function(_24){return {referenceId:_24};},getCurrentContent:function(){return this._contentStructureStore.get(this.get("data"));},generateFormatters:function(_25){this.inherited(arguments);var _26=_25["contentTypeIdentifier"];if(_26){_26.formatter=_1b.hitch(this,_1e.contentIcon);}for(var _27 in _25){_1b.setObject("sortable",false,_25[_27]);}return _25;}});});},"epi-ecf-ui/contentediting/editors/AssociationGroupSelectionEditor":function(){define(["dojo/_base/declare","dijit/form/Select","epi/dependency"],function(_28,_29,_2a){return _28([_29],{storeKey:"epi.commerce.associationgroupdefinition",constructor:function(){this.store=this.store||_2a.resolve("epi.storeregistry").get(this.storeKey);this.labelAttr="name";}});});},"epi-ecf-ui/widget/CatalogContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","epi/shell/layout/SimpleContainer","epi-cms/contentediting/ContentDetails","dojo/text!./templates/CatalogContentDetails.html"],function(_2b,_2c,_2d,_2e,url,win,_2f,_30,_31,_32,_33){return _2d([_32],{templateString:_33,buildRendering:function(){this.inherited(arguments);this.dropdownButton.set("tooltip",this.resources.toolsbutton.tooltip);},addChild:function(w){this.widgetContainer.addChild(w);},_setExistingLanguagesAttr:function(_34){this.languagesNode.innerHTML="";_2c.forEach(_34,function(_35,idx){var elm,_36=idx===_34.length-1;if(this.model.dataModel.currentContentLanguage===_35.text){elm=_30.create("span",{innerHTML:_35.urlSegment});}else{var url=new _2b._Url(window.top.location.href);elm=_30.create("a",{innerHTML:_35.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",_35.text,"#context=epi.cms.contentdata:///",_35.contentLink].join(""),"class":"epi-visibleLink"});}_30.place(elm,this.languagesNode);if(!_36){_30.place(win.doc.createTextNode(", "),this.languagesNode);}},this);}});});},"url:epi-ecf-ui/widget/templates/CatalogContentDetails.html":"<div class=\"epi-containerLayout\">\r\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\r\n    <ul>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.visibleto.title}</label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"visibleToNode\" class=\"dijitInline\"></span>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink\">${resources.manage}</div>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.existinglanguages}</label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"languagesNode\" class=\"dijitInline\"></span>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.idandtypename}</label> \r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"idNode\" class=\"dijitInline\"></span>, <span data-dojo-attach-point=\"typeNode\" class=\"dijitInline\"></span>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label></label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\r\n                    <span>${resources.toolsbutton.label}</span>\r\n                    <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\r\n                </div>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</div>","epi-ecf-ui/component/CatalogNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/component/ContentNavigationTree","../widget/viewmodel/CatalogTreeStoreModel","./ContentContextMenuCommandProvider"],function(_37,_38,_39,_3a,_3b){return _38([_39],{contextMenuCommandProvider:_3b,_createTreeModel:function(){return new _3a({root:this.root,typeIdentifiers:this.typeIdentifiers,containedTypes:this.settings.containedTypes});},_createTreeNode:function(){var _3c=this.inherited(arguments);if(_3c.item&&_3c.item.contentLink==this.tree.model.roots[0]){_3c.hasContextMenu=false;}return _3c;}});});},"epi-ecf-ui/widget/viewmodel/CatalogTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/request","dojo/when","dojo/topic","epi/dependency","epi/routes","epi/string","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Dialog","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","../../contentediting/ModelSupport","../CatalogPasteItemDialog","epi/i18n!epi/nls/commerce.components.catalogtree"],function(_3d,_3e,_3f,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_4a,_4b,_4c,_4d,_4e,_4f){return _3e([_4c],{relationStore:null,typeDescriptorManager:_4a,constructor:function(){this.relationStore=this.relationStore||_45.resolve("epi.storeregistry").get("epi.commerce.relation");this.contentTypeStore=this.contentTypeStore||_45.resolve("epi.storeregistry").get("epi.cms.contenttype");this._handles.push(_44.subscribe("relationChanged",_3f.hitch(this,this._relationChanged)));},_relationChanged:function(_50){this._childrenChanged(_50.target);},newItems:function(_51,_52){this._selectAction(_51,_52);},newItem:function(_53,_54,_55){this._performAction(_53,_54,_55);},pasteItems:function(_56,_57){this._selectAction(_56,_57);},pasteItem:function(_58,_59,_5a,_5b){if(typeof _5b==="string"){if(!_58||!_5a){return;}switch(_5b){case "link":return this._addRelation(_58,_5a);case "move":if(_4b.compareIgnoreVersion(_58.parentLink,_59.contentLink)){return this.inherited(arguments,[_58,_59,_5a,false]);}else{return this._replaceRelation(_58,_59,_5a);}break;case "duplicate":return this.inherited(arguments,[_58,_59,_5a,true]);default:break;}}},_selectAction:function(_5c,_5d){var _5e=function(_5f,_60){return _3d.every(_5f,function(_61){if(!_61.dndData||!_61.dndData.data){return false;}return _60.indexOf(_61.dndData.data.contentTypeID)>-1;});};return _43(this._isContentTypeAllowed(_5c,_5d,_5e),_3f.hitch(this,function(_62){if(!_62){this._showContentTypeAlert();return false;}var _63=this._isLinkSupported(_5d.typeIdentifier);return _43(this._newItemConfirmation(false,!_63),_3f.hitch(this,function(_64){var _65=_3d.map(_5c,function(_66){return this._performAction(_66,_5d,_64);},this);return _41(_65);}));}));},_showContentTypeAlert:function(_67){if(this._invalidContentTypeAlertDialog){this._invalidContentTypeAlertDialog.destroy();}this.own(this._invalidContentTypeAlertDialog=new _48({destroyOnHide:true,description:_47.toHTML(_4f.contenttypesnotallowed)}));this._invalidContentTypeAlertDialog.show();},_performAction:function(_68,_69,_6a){var _6b=_68.dndData.data;if(_6b){var _6c=this.getParentItem(_68.dndData);return this.pasteItem(_6b,_6c,_69,_6a);}},getParentItem:function(_6d){if(_6d&&_6d.options&&_6d.options.oldParentItem){return _6d.options.oldParentItem;}throw "The item is not supported. The drag source must specify options containing the oldParentItem.";},_newItemConfirmation:function(_6e,_6f){var _70=new _40();var _71=new _4e({hideMoveOption:_6e,hideLinkOption:_6f,executeDialog:function(_72){_70.resolve(_72);},cancelDialog:function(){_70.cancel();}});var _73=new _49({dialogClass:"epi-dialog-confirm",defaultActionsVisible:false,content:_71,title:_71.title,destroyOnHide:true});_73.show();return _70.promise;},_selectItemOnPasteComplete:function(_74,_75,_76,_77,_78){},_getRelations:function(_79){return this.relationStore.query({referenceId:_79});},_addRelation:function(_7a,_7b){return _43(this._getRelations(_7a.contentLink),_3f.hitch(this,function(_7c){var _7d=0;_3d.forEach(_7c,function(_7e){if(_7e.sortOrder>_7d){_7d=_7e.sortOrder;}});return _43(this.relationStore.add({source:_7a.contentLink,target:_7b.contentLink,type:_4d.relationType.node,sortOrder:_7d+100}),function(_7f){_44.publish("relationChanged",_7f);});}));},_replaceRelation:function(_80,_81,_82){return _43(this._getRelations(_80.contentLink),_3f.hitch(this,function(_83){_3d.forEach(_83,function(_84){if(_84.type==_4d.relationType.node&&_4b.compareIgnoreVersion(_84.target,_81.contentLink)){var _85={source:_80.contentLink,target:_82.contentLink,type:_4d.relationType.node,sortOrder:_84.sortOrder};return _43(this.relationStore.remove(_84.id),_3f.hitch(this,function(){return _43(this.relationStore.add(_85),function(_86){_44.publish("relationChanged",_86);});}));}},this);}));},copy:function(_87,_88){return _43(this._isContentTypeAllowed(_87,_88),_3f.hitch(this,function(_89){if(!_89){this._showContentTypeAlert();return;}var _8a=this._isLinkSupported(_88.typeIdentifier);return _43(this._newItemConfirmation(true,!_8a),_3f.hitch(this,function(_8b){var _8c=_3d.map(_87,function(_8d){return _43(this.store.get(_8d.data.parentLink),_3f.hitch(this,function(_8e){return this.pasteItem(_8d.data,_8e,_88,_8b);}));},this);return _41(_8c).then(_3f.hitch(this,function(_8f){_44.publish("itemPasted",_8f);}));}));}));},_isContentTypeAllowed:function(_90,_91,_92){return _43(this.contentTypeStore.query({query:"getavailablecontenttypes",parentReference:_91.contentLink}),_3f.hitch(this,function(_93){var _94=_3d.map(_93,function(_95){return _95.id;});if(!_92){_92=function(_96,_97){return _3d.every(_96,function(_98){if(!_98.data){return false;}return _97.indexOf(_98.data.contentTypeID)>-1;});};}return _92(_90,_94);}));},move:function(_99,_9a){if(!_9a.contentLink){_9a=this.store.get(_9a);}return _43(this._isContentTypeAllowed(_99,_9a),_3f.hitch(this,function(_9b){if(!_9b){this._showContentTypeAlert();return;}var _9c=_3d.map(_99,function(_9d){if(_9d.data){var _9e={contentLink:new _4b(_9d.data.parentLink).createVersionUnspecificReference().toString()};return this.pasteItem(_9d.data,_9e,_9a,"move");}},this);return _41(_9c).then(_3f.hitch(this,function(_9f){_44.publish("itemPasted",_9f);}));}));},onDeleted:function(_a0){_44.publish("catalogContentDeleted",_a0);},remove:function(_a1){var _a2=_46.getActionPath({moduleArea:"episerver.commerce.addons.ui",controller:"Delete",action:"Delete"}),_a3=_3d.map(_a1,function(_a4){return _a4.data.contentLink;}),_a5=_42.post(_a2,{data:{contentReferences:_a3}});return _43(_a5,_3f.hitch(this,function(){return _43(this.currentContentService.getCurrentContext(),_3f.hitch(this,function(_a6){_3d.some(_a1,function(_a7){if(_4b.compareIgnoreVersion(_a6.id,_a7.data.contentLink)&&_a7.data.parentLink){this.onSelect(_a7.data.parentLink,true);return true;}},this);var _a8=_3d.map(_a3,function(_a9){return this.store.refresh(_a9);},this);return _43(_41(_a8),_3f.hitch(this,function(){this.onDeleted(_a1);}));}));}));},_isLinkSupported:function(_aa){return this.typeDescriptorManager.isBaseTypeIdentifier(_aa,_4d.contentTypeIdentifier.entryContentBase)||this.typeDescriptorManager.isBaseTypeIdentifier(_aa,_4d.contentTypeIdentifier.nodeContent);},isSupportedType:function(_ab){var _ac=this.inherited(arguments);var _ad=_3d.some(this.containedTypes,function(_ae){return this.typeDescriptorManager.isBaseTypeIdentifier(_ab,_ae);},this);return _ac||_ad;}});});},"dojo/request":function(){define("dojo/request",["./request/default!"],function(_af){return _af;});},"dojo/request/default":function(){define("dojo/request/default",["exports","require","../has"],function(_b0,_b1,has){var _b2=has("config-requestProvider"),_b3;if(1){_b3="./xhr";}else{if(0){_b3="./node";}}if(!_b2){_b2=_b3;}_b0.getPlatformDefaultId=function(){return _b3;};_b0.load=function(id,_b4,_b5,_b6){_b1([id=="platform"?_b3:_b2],function(_b7){_b5(_b7);});};});},"epi-ecf-ui/contentediting/ModelSupport":function(){define([],function(){var _b8={relationType:{undefined:0,node:1,bundleEntry:2,packageEntry:3,productVariation:4},contentTypeIdentifier:{bundleContent:"episerver.commerce.catalog.contenttypes.bundlecontent",catalogContent:"episerver.commerce.catalog.contenttypes.catalogcontent",catalogContentBase:"episerver.commerce.catalog.contenttypes.catalogcontentbase",entryContentBase:"episerver.commerce.catalog.contenttypes.entrycontentbase",nodeContent:"episerver.commerce.catalog.contenttypes.nodecontent",nodeContentBase:"episerver.commerce.catalog.contenttypes.nodecontentbase",packageContent:"episerver.commerce.catalog.contenttypes.packagecontent",productContent:"episerver.commerce.catalog.contenttypes.productcontent",rootContent:"episerver.commerce.catalog.contenttypes.rootcontent",variationContent:"episerver.commerce.catalog.contenttypes.variationcontent"},linkTypeIdentifier:{association:"episerver.commerce.catalog.linking.association",relation:"episerver.commerce.catalog.linking.relation"}};return _b8;});},"epi-ecf-ui/widget/CatalogPasteItemDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dijit/_Widget","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/dialog/_DialogContentMixin","epi/i18n!epi/cms/nls/commerce.widget.pasteitemdialog"],function(_b9,_ba,_bb,_bc,_bd,_be,_bf){return _b9([_bc,_bd,_be],{hideMoveOption:false,hideLinkOption:false,title:_bf.title,buildRendering:function(){this.inherited(arguments);_bb.create("span",{innerHTML:_bf.message},this.domNode);},getActions:function(){this._actions=[];this._actions.push({name:"duplicate",label:_bf.duplicate,settings:{type:"button"},action:_ba.hitch(this,function(){this.executeDialog("duplicate");})});if(!this.hideLinkOption){this._actions.push({name:"link",label:_bf.link,settings:{type:"button"},action:_ba.hitch(this,function(){this.executeDialog("link");})});}if(!this.hideMoveOption){this._actions.push({name:"move",label:_bf.move,settings:{type:"button"},action:_ba.hitch(this,function(){this.executeDialog("move");})});}this._actions.push({name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:_ba.hitch(this,function(){this.cancelDialog();})});return this._actions;}});});},"epi-ecf-ui/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","epi/shell/selection","epi/shell/command/withConfirmation","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/component/command/ChangeContext","epi-cms/command/DeleteContent","epi-cms/command/CutContent","epi-cms/command/CopyContent","epi-cms/command/PasteContent","epi-cms/command/TranslateContent","./DeleteCatalogContentHandler","../contentediting/ModelSupport","epi/i18n!epi/cms/nls/commerce.components.catalogs.commands","epi/i18n!epi/nls/episerver.shared"],function(_c0,_c1,_c2,_c3,_c4,_c5,_c6,_c7,_c8,_c9,_ca,_cb,_cc,res,_cd){return _c1([_c4],{postscript:function(){this.inherited(arguments);var _ce=this.get("commands");_c0.some(_ce,function(_cf){if(_cf.isInstanceOf(_c6)){this._updateDeleteCommand(_cf);return true;}},this);var _d0=new _c5({category:"context",forceContextChange:true,viewName:"formedit"});_ce.splice(0,0,_d0);this.set("commands",_ce);},updateCommandModel:function(_d1){this.inherited(arguments);_c0.some(this.get("commands"),function(_d2){if(_d2.isInstanceOf(_ca)){_d2.set("isAvailable",false);}if(_d2.isInstanceOf(_c5)){_d2.set("model",_d1);}if(_d2.selection){_d2.selection.set("data",_d1?[{type:"epi.cms.contentdata",data:_d1}]:[]);}if(_d2.isInstanceOf(_c7)||_d2.isInstanceOf(_c8)||_d2.isInstanceOf(_c9)){if(_d1&&_d1.typeIdentifier!==_cc.contentTypeIdentifier.rootContent&&_d1.typeIdentifier!==_cc.contentTypeIdentifier.catalogContent){_d2.set("isAvailable",true);}else{_d2.set("isAvailable",false);}}if(_d2.isInstanceOf(_c5)||_d2.isInstanceOf(_c6)){if(_d1&&_d1.typeIdentifier!==_cc.contentTypeIdentifier.rootContent&&_d1.typeIdentifier!==_cc.contentTypeIdentifier.catalogContent){_d2.set("isAvailable",true);}else{_d2.set("isAvailable",false);}}},this);},_updateDeleteCommand:function(_d3){_d3=_c3(_d3,_cb,{title:res.deleteconfirmationtitle,description:res.deleteconfirmationdescription,confirmActionText:_cd.action.deletelabel,cancelActionText:_cd.action.cancel});}});});},"epi-ecf-ui/component/DeleteCatalogContentHandler":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","./DeleteConfirmation"],function(_d4,_d5,_d6,_d7,_d8){var _d9=function(_da){var _db=new _d6(),_dc=new _d8(_da);_dc.connect(_dc,"onAction",function(_dd){if(_dd){_db.resolve();}else{_db.cancel();}});_dc.show();_d7.subscribe("catalogContentDeleted",function(){_dc.hide();});_d7.subscribe("/epi/cms/action/delete/error",function(){_dc.hide();});return _db;};return _d9;});},"epi-ecf-ui/component/DeleteConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojox/widget/Standby","epi/shell/widget/dialog/Confirmation"],function(_de,_df,_e0,_e1){return _de([_e1],{_standBy:null,postCreate:function(){this.inherited(arguments);this._standBy=new _e0({target:this.domNode,color:"#fff"}).placeAt(document.body);this._standBy.startup();this.own(this._standBy);},_onConfirm:function(){this._standBy.show();for(var _e2 in this.definitionConsumer._widgetMap){var _e3=this.definitionConsumer._widgetMap[_e2];_e3.set("disabled",true);}this.onAction(true);}});});},"epi-ecf-ui/contentediting/editors/CategoryCollectionReadOnlyEditor":function(){define(["dojo/_base/declare","./ReadOnlyCollectionEditor","../viewmodel/CategoryCollectionReadOnlyEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.categorycollectioneditor"],function(_e4,_e5,_e6,res){return _e4([_e5],{iconClass:"epi-iconCategory",modelType:_e6,_renderNoDataMessage:function(){this.grid.set("noDataMessage",res.nodatamessage);this.inherited(arguments);},changeToView:"linksview",buttonLabel:res.editbuttontext});});},"epi-ecf-ui/contentediting/viewmodel/CategoryCollectionReadOnlyEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","../ModelSupport","./ReadOnlyCollectionEditorModel"],function(_e7,_e8,_e9,_ea){return _e7([_ea],{_storeKey:"epi.commerce.relation",createQuery:function(_eb){return {referenceId:_eb,relationTypes:[_e9.relationType.node]};}});});},"epi-ecf-ui/contentediting/editors/VariantCollectionReadOnlyEditor":function(){define(["dojo/_base/declare","./ReadOnlyCollectionEditor","../viewmodel/VariantCollectionReadOnlyEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.variantcollectioneditor"],function(_ec,_ed,_ee,res){return _ec([_ed],{iconClass:"epi-iconObjectVariation",modelType:_ee,_renderNoDataMessage:function(){this.grid.set("noDataMessage",res.nodatamessage);this.inherited(arguments);},changeToView:"variantview",buttonLabel:res.editbuttontext});});},"epi-ecf-ui/contentediting/viewmodel/VariantCollectionReadOnlyEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","../ModelSupport","./ReadOnlyCollectionEditorModel"],function(_ef,_f0,_f1,_f2){return _ef([_f2],{_storeKey:"epi.commerce.relation",createQuery:function(_f3){return {referenceId:_f3,relationTypes:[_f1.relationType.productVariation]};}});});},"epi-ecf-ui/contentediting/editors/BundleEntryCollectionReadOnlyEditor":function(){define(["dojo/_base/declare","./ReadOnlyCollectionEditor","../viewmodel/BundleEntryCollectionReadOnlyEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.bundleentrycollectioneditor"],function(_f4,_f5,_f6,res){return _f4([_f5],{iconClass:"epi-iconObjectBundle",modelType:_f6,_renderNoDataMessage:function(){this.grid.set("noDataMessage",res.nodatamessage);this.inherited(arguments);},changeToView:"bundleview",buttonLabel:res.editbuttontext});});},"epi-ecf-ui/contentediting/viewmodel/BundleEntryCollectionReadOnlyEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","../ModelSupport","./ReadOnlyCollectionEditorModel"],function(_f7,_f8,_f9,_fa){return _f7([_fa],{_storeKey:"epi.commerce.relation",createQuery:function(_fb){return {referenceId:_fb,relationTypes:[_f9.relationType.bundleEntry]};}});});},"epi-ecf-ui/contentediting/editors/PackageEntryCollectionReadOnlyEditor":function(){define(["dojo/_base/declare","./ReadOnlyCollectionEditor","../viewmodel/PackageEntryCollectionReadOnlyEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.packageentrycollectioneditor"],function(_fc,_fd,_fe,res){return _fc([_fd],{iconClass:"epi-iconObjectPackage",modelType:_fe,_renderNoDataMessage:function(){this.grid.set("noDataMessage",res.nodatamessage);this.inherited(arguments);},changeToView:"packageview",buttonLabel:res.editbuttontext});});},"epi-ecf-ui/contentediting/viewmodel/PackageEntryCollectionReadOnlyEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","../ModelSupport","./ReadOnlyCollectionEditorModel"],function(_ff,lang,_100,_101){return _ff([_101],{_storeKey:"epi.commerce.relation",createQuery:function(_102){return {referenceId:_102,relationTypes:[_100.relationType.packageEntry]};}});});},"epi-ecf-ui/contentediting/editors/CommerceMediaCollectionEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-style","dojo/topic","epi/shell/widget/_FocusableMixin","epi/shell/dnd/Target","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/_TextWithActionLinksMixin","epi-ecf-ui/contentediting/editors/model/CommerceMediaCollectionEditorModel","epi-ecf-ui/component/CommerceMediaItemModel","dojo/text!./templates/CommerceMediaEditor.html","epi/i18n!epi/cms/nls/commerce.contentediting.editors.commercemediacollectioneditor"],function(_103,lang,_104,_105,_106,_107,_108,_109,_10a,_10b,_10c,_10d,_10e,res){return _103([_10a,_10b,_108],{_dndTarget:null,templateString:_10e,resources:res,gridOverlayClass:"epi-grid-dnd-overlay",_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+res.nodatamessage+"</span></span>",itemModelType:_10d,modelType:_10c,dialogParams:{autofocus:false},_setupGrid:function(){this.inherited(arguments);_105.add(this.gridNode,"epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");this._settingReadOnlyState();},postCreate:function(){this.inherited(arguments);this._dndTarget=new _109(this.dropContainer,{accept:this.allowedDndTypes,insertNodes:function(){}});this.own(_104.after(this._dndTarget,"onDropData",lang.hitch(this,this.onDndDrop),true));_105.add(this.domNode,"epi-media-collection");this.setupActionLinks(this.dropContainer);},_settingReadOnlyState:function(){if(this.readOnly){_106.set(this.dropContainer,"display","none");_105.remove(this.overlayDnd,this.gridOverlayClass);this.grid.set("selectionMode","none");this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;this.model.availableCommands=0;}},_getDialogTitleText:function(_10f){return !_10f?res.addlabel:res.editlabel;},getTemplateString:function(){return {templateString:this.resources.drophere,actions:this.resources.actions};},executeAction:function(_110){_107.publish("/epi/layout/pinnable/tools/toggle",true);},_getGridDefinition:function(){var _111=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};if(this.readOnly){for(var _112 in _111){lang.setObject("sortable",false,_111[_112]);}}return this.model.generateFormatters(_111);},_setupDnD:function(){this.inherited(arguments);var _113=this.grid.dndSource;this.own(_104.after(_113,"onDndStart",lang.hitch(this,function(_114,_115,copy){var _116=_113.accept&&_113.checkAcceptance(_114,_115);_105[_116?"add":"remove"](this.overlayDnd,this.gridOverlayClass);}),true));}});});},"epi-ecf-ui/contentediting/editors/model/CommerceMediaCollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.commercemediacollectioneditor"],function(_117,_118,lang,_119,_11a,_11b,res){return _118([_11b],{addItem:function(item,_11c,_11d){var _11e=this.get("items");if(!_11e||_11e.length<1){return this.inherited(arguments);}var _11f=item.permanentUrl||item.assetKey;var _120;_117.some(_11e,function(_121){if(_121&&_121.assetKey==_11f){_120=_121;return true;}});if(_120){var def=new _119();this.moveItem(_120,_11c||_120,_11d||true);def.resolve();return def;}else{return this.inherited(arguments);}},getListCommands:function(_122){return [new _11a({name:"add",label:res.addlabel,iconClass:"epi-iconPlus",canExecute:true,isAvailable:true,delegate:lang.hitch(this,this.addItemDelegate)})];}});});},"epi-ecf-ui/component/CommerceMediaItemModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Stateful","dojo/when","epi/dependency","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/core/PermanentLinkHelper"],function(_123,_124,lang,_125,_126,when,_127,_128,_129){return _124([_128,_126],{fromItemData:function(_12a){var df=new _125();_12a.assetKey=_12a.assetKey||_12a.permanentUrl;when(_129.getContent(_12a.assetKey),lang.hitch(this,function(_12b){if(_12b){_12a.assetName=_12b.name;_12a.assetKey=_129.toPermanentLink(_12b);_12a.assetType=_12a.assetType||_12b.typeIdentifier;}_12a.groupName=_12a.groupName||"default";_12a.sortOrder=_12a.sortOrder||0;lang.mixin(this,_12a);this._itemData=_12a;df.resolve(this);}));return df;}});});},"url:epi-ecf-ui/contentediting/editors/templates/CommerceMediaEditor.html":"<div class=\"dijitInline\" style=\"width: 100%;\">    \r\n    <div data-dojo-attach-point=\"commandTargetNode\"></div>\r\n    <div data-dojo-attach-point=\"overlayDnd\">\r\n        <div data-dojo-attach-point=\"gridNode\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dropContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n</div>\r\n","epi-ecf-ui/widget/overlay/CommerceMediaCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/widget/overlay/ItemCollection","epi/string","../../component/CommerceMediaItemModel"],function(_12c,lang,when,_12d,_12e,_12f){return _12c([_12d],{modelType:"epi-ecf-ui/contentediting/editors/model/CommerceMediaCollectionEditorModel",onDrop:function(_130,_131){var _132=null,_133=this.model.get("items");if(_133){_132=_133[0];}when(this.model.addItem(_131,_132,true),lang.hitch(this,function(){var _134=this.model.get("data");this.onValueChange({propertyName:this.name,value:_134});}));},_setupModel:function(data){var _135=_12e.slashName(this.modelType);require([_135],lang.hitch(this,function(_136){var _137={};_137.itemModelType=_12f;_137.itemType="EPiServer.Commerce.AddOns.UI.ObjectEditing.InternalMetadata.CommerceMediaModel";this.model=new _136(_137,this.modelParams);this.model.set("data",data);}));},_setupAllowedTypes:function(){var _138=this.modelParams.itemConverterKey,_139=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_138){_139=_139+"."+_138;}if(_139){this.allowedDndTypes.unshift(_139);}}});});},"epi-ecf-ui/contentediting/editors/InventoryCollectionEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","./ReadOnlyCollectionEditor","../viewmodel/InventoryCollectionEditorModel"],function(_13a,lang,_13b,_13c){return _13a([_13b],{modelType:_13c});});},"epi-ecf-ui/contentediting/viewmodel/InventoryCollectionEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","./ReadOnlyCollectionEditorModel"],function(_13d,lang,_13e){return _13d([_13e],{_storeKey:"epi.commerce.inventory"});});},"epi-ecf-ui/contentediting/editors/PriceCollectionReadOnlyEditor":function(){define(["dojo/_base/declare","./ReadOnlyCollectionEditor","../viewmodel/PriceCollectionReadOnlyEditorModel","epi/i18n!epi/cms/nls/commerce.components.catalogs.commands"],function(_13f,_140,_141,res){return _13f([_140],{iconClass:"epi-iconPricing",modelType:_141,changeToView:"pricingview",buttonLabel:res.previewprice});});},"epi-ecf-ui/contentediting/viewmodel/PriceCollectionReadOnlyEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/currency","epi/datetime","./ReadOnlyCollectionEditorModel","epi/i18n!epi/cms/nls/commerce.widget.pricecollection.message"],function(_142,lang,_143,_144,_145,res){return _142([_145],{_storeKey:"epi.commerce.price",res:res,generateFormatters:function(_146){this.inherited(arguments);_146["validDate"].formatter=lang.hitch(this,this._formatValidDate);_146["unitPrice"].formatter=function(_147){return _143.format(_147.amount,{currency:_147.currency});};return _146;},_formatValidDate:function(_148){return this._formatDate(_148.validFrom)+" - "+this._formatDate(_148.validUntil);},_formatDate:function(_149){return _149&&_149!==""?_144.toUserFriendlyString(_149):this.res.untildatenotdefined;},createQuery:function(_14a){return {referenceId:_14a,query:"readonlyprices"};}});});},"dojo/currency":function(){define("dojo/currency",["./_base/array","./_base/lang","./number","./i18n","./i18n!./cldr/nls/currency","./cldr/monetary"],function(_14b,lang,_14c,i18n,_14d,_14e){var _14f={};lang.setObject("dojo.currency",_14f);_14f._mixInDefaults=function(_150){_150=_150||{};_150.type="currency";var _151=i18n.getLocalization("dojo.cldr","currency",_150.locale)||{};var iso=_150.currency;var data=_14e.getData(iso);_14b.forEach(["displayName","symbol","group","decimal"],function(prop){data[prop]=_151[iso+"_"+prop];});data.fractional=[true,false];return lang.mixin(data,_150);};_14f.format=function(_152,_153){return _14c.format(_152,_14f._mixInDefaults(_153));};_14f.regexp=function(_154){return _14c.regexp(_14f._mixInDefaults(_154));};_14f.parse=function(_155,_156){return _14c.parse(_155,_14f._mixInDefaults(_156));};return _14f;});},"dojo/cldr/monetary":function(){define("dojo/cldr/monetary",["../_base/kernel","../_base/lang"],function(dojo,lang){var _157={};lang.setObject("dojo.cldr.monetary",_157);_157.getData=function(code){var _158={ADP:0,AFN:0,ALL:0,AMD:0,BHD:3,BIF:0,BYR:0,CLF:0,CLP:0,COP:0,CRC:0,DJF:0,ESP:0,GNF:0,GYD:0,HUF:0,IDR:0,IQD:0,IRR:3,ISK:0,ITL:0,JOD:3,JPY:0,KMF:0,KPW:0,KRW:0,KWD:3,LAK:0,LBP:0,LUF:0,LYD:3,MGA:0,MGF:0,MMK:0,MNT:0,MRO:0,MUR:0,OMR:3,PKR:0,PYG:0,RSD:0,RWF:0,SLL:0,SOS:0,STD:0,SYP:0,TMM:0,TND:3,TRL:0,TZS:0,UGX:0,UZS:0,VND:0,VUV:0,XAF:0,XOF:0,XPF:0,YER:0,ZMK:0,ZWD:0};var _159={CHF:5};var _15a=_158[code],_15b=_159[code];if(typeof _15a=="undefined"){_15a=2;}if(typeof _15b=="undefined"){_15b=0;}return {places:_15a,round:_15b};};return _157;});},"epi-ecf-ui/widget/CatalogContentList":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/keys","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/html","dojo/on","dojo/topic","dojo/when","dojo/dom-class","dgrid/selector","epi","epi/shell/dgrid/util/misc","epi/dependency","epi/shell/widget/_FocusableMixin","epi/shell/command/builder/ButtonBuilder","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/formatters","epi-cms/widget/_ConfigurableContentListBase","epi-cms/widget/ContentTreeStoreModel","./viewmodel/CatalogContentListViewModel","./CommandToolbar","./MarketSelector","dojo/text!./templates/CatalogContentList.html","epi/i18n!epi/cms/nls/commerce.widget.cataloglist","epi/i18n!epi/cms/nls/commerce.widget.catalogcontentlist"],function(_15c,_15d,_15e,lang,_15f,keys,_160,_161,_162,html,on,_163,when,_164,_165,epi,misc,_166,_167,_168,_169,_16a,_16b,_16c,_16d,_16e,_16f,_170,_171,res,_172){return _15e([_16c,_167],{resources:_172,templateString:_171,_multipleSelectionClassName:"epi-dgrid-multiselect--multiple-selection",storeKeyName:"epi.cms.content.light",contextChangeEvent:"",commandToolbar:null,postCreate:function(){this.inherited(arguments);this.own(this.model.clipboardManager.watch("data",lang.hitch(this,function(name,_173,_174){var _175=this.model.clipboardManager.isCopy(),grid=this.grid;var _176=function(_177,_178){_15c.forEach(_177,function(clip){var row;if(clip&&clip.data){var _179=clip.contextId.concat("-",clip.data.contentLink);row=grid.row(_179);if(row&&row.element){_164.toggle(row.element,"epi-opacity50",_178);}}});};if(_173 instanceof Array){_176(_173,false);}if(!_175&&_174 instanceof Array){_176(_174,true);}})));},startup:function(){this.inherited(arguments);this.grid.set("selectionMode","none");this.grid.dndSource.singular=false;this.own(_163.subscribe("relationChanged",lang.hitch(this,function(){this.grid.refresh();})),_163.subscribe("catalogContentDeleted",lang.hitch(this,function(_17a){when(this.getCurrentContext(),lang.hitch(this,function(_17b){var _17c=_15c.some(_17a,function(item){return _169.compareIgnoreVersion(_17b.id,item.data.parentLink);});if(_17c){this.grid.clearSelection();this.onDeselectedRow();this.grid.refresh();}}));})),_163.subscribe("itemPasted",lang.hitch(this,function(){this.grid.refresh();})));this.grid.on("dgrid-rowcopy",lang.hitch(this,this._onRowCopy));this.grid.on("dgrid-rowcut",lang.hitch(this,this._onRowCut));this.grid.on("dgrid-rowpaste",lang.hitch(this,this._onRowPaste));this.grid.addKeyHandler(keys.ENTER,lang.hitch(this,"_onChangeContext"));this.grid.addKeyHandler(keys.SPACE,lang.hitch(this,function(evt){var row=this.grid.row(evt);if(this.grid.isSelected(row)){this.grid.deselect(row);}else{this.grid.select(row);}}));},_onRowCopy:function(){this.model._commandRegistry.copy.command.execute();},_onRowCut:function(){this.model._commandRegistry.cut.command.execute();},_onRowPaste:function(){this.model._commandRegistry.pasteOnContext.command.execute();},buildRendering:function(){this.baseClass="epi-plain-grid epi-dgrid-multiselect";this.inherited(arguments);var _17d=this.model.getSelectionCommands();this.commandToolbar=new _16f(_17d);this.own(this.commandToolbar);_160.place(this.commandToolbar.domNode,this.leadingNode);this.own(_15d.after(this.commandToolbar,"layout",lang.hitch(this,function(){this.resize();})));},resize:function(){this.inherited(arguments);if(this.grid){this.grid.resize();var top=_161.position(this.grid.domNode).y;var _17e=_161.position(_15f.body()).h;_162.set(this.grid.domNode,"height",(_17e-top)+"px");}},setupEvents:function(){this.inherited(arguments);this.own(this.grid.on("dgrid-deselect",lang.hitch(this,this.onDeselectedRow)));this.own(this.grid.on(".epi-iconContextMenu:click",lang.hitch(this,this.onContextMenuClick)));for(var _17f in this.getColumnSettings()){if(_17f=="checkbox"){this.own(this.grid.on(".dgrid-cell.dgrid-column-"+_17f+":mousedown",lang.hitch(this,function(e){this._isColumnDraggable=false;})),on(this.grid.domNode,"mouseup",lang.hitch(this,function(e){this._isColumnDraggable=true;})));continue;}this.own(this.grid.on(".dgrid-cell.dgrid-column-"+_17f+":click",lang.hitch(this,"_onChangeContext")));}var self=this;_15d.around(this.grid.dndSource,"onMouseMove",function(_180){return function(e){if(!self._isColumnDraggable){return;}return _180.call(self.grid.dndSource,e);};});},onDeselectedRow:function(){var _181=[];for(var id in this.grid.selection){var row=this.grid.row(id);_181.push(row.data);}this.model.updateSelection(_181);this._removeContextMenuWhenRowIsSelected();},getListSettings:function(){var _182=this.inherited(arguments);return lang.mixin(_182,{cellNavigation:false});},_onSelect:function(){this.inherited(arguments);this._removeContextMenuWhenRowIsSelected();},_removeContextMenuWhenRowIsSelected:function(){_164.remove(this.grid.contentNode,this._multipleSelectionClassName);if(this.model.numSelectedRows>0){_164.add(this.grid.contentNode,this._multipleSelectionClassName);}},onContextMenuClick:function(e){var row=this.grid.row(e);this.model.set("model",{data:[row.data]});_15c.forEach(this.grid.contextMenu.getChildren(),function(menu,i){if(menu.arrowWrapper&&menu.popup){_162.set(menu.arrowWrapper,"visibility","");}});this.grid.clearSelection();this.grid.select(row);},createModel:function(){return new _16e();},fetchData:function(_183){this._setGridQuery(_183.id);when(this.store.get(_183.id),lang.hitch(this,function(_184){this.onDeselectedRow();var _185=this.model._commandRegistry.pasteOnContext.command;_185.selection.set("data",[{type:"epi.cms.contentdata",data:_184}]);}));},_setGridQuery:function(id){var _186={ignore:["query"],parentId:id,sort:[{attribute:"typeSortIndex"}]};var _187={referenceId:id,query:"getchildren",market:this.marketSelector.value,includeProperties:true,allLanguages:true};this.grid.set("query",_187,_186);},getColumnSettings:function(){return {checkbox:_165({label:"",selectorType:"checkbox",className:"epi-columnVeryNarrow"}),typeSortIndex:{renderHeaderCell:function(node){},get:function(_188){return _188.typeIdentifier;},formatter:_16b.contentIcon,className:"epi-columnIcon16x16"},name:{label:epi.resources.header.name,className:"epi-columnWide"},code:{get:function(_189){return _189.properties.code;},label:res.code},price:{get:function(_18a){return _18a.properties.price;},label:res.price,sortable:false},stock:{get:function(_18b){return {count:_18b.properties.inStockQuantity,status:_18b.properties.inStockStatus};},label:res.stock,formatter:this._getStockElement,sortable:false},isPendingPublish:{get:function(_18c){return _18c.status==_16a.versionStatus.Published;},label:res.active,formatter:_16b.friendlyBoolean,className:"epi-columnNarrow"},startPublish:{get:function(_18d){return _18d.properties.startPublish;},label:res.availablefrom,formatter:this._localizedDateAndSecondaryText},stopPublish:{get:function(_18e){return _18e.properties.stopPublish;},label:epi.resources.header.expires,formatter:this._localizedDateAndSecondaryText},metaClassName:{get:function(_18f){return _18f.properties.metaClassName;},label:res.producttype,formatter:_16b.secondaryText}};},_getStockElement:function(_190){if(_190.count===undefined||_190.count===null){return "";}var _191="epi-stock-"+_190.status;return "<span class=\"epi-stock "+_191+"\">"+_190.count+misc.icon("epi-iconBoxes")+"</span>";},_localizedDateAndSecondaryText:function(_192){return _16b.secondaryText(_16b.localizedDate(_192),true);},_onMarketChanged:function(){if(!this.grid){return;}var _193=this.grid.get("queryOptions");if(_193){this._setGridQuery(_193.parentId);}}});});},"dgrid/selector":function(){define("dgrid/selector",["dojo/_base/kernel","dojo/_base/array","dojo/on","dojo/aspect","dojo/_base/sniff","put-selector/put"],function(_194,_195,on,_196,has,put){return function(_197,type){var _198=[],grid,_199;if(!_197){_197={};}if(_197.type){_197.selectorType=_197.type;_194.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4");}_197.selectorType=type=type||_197.selectorType||"checkbox";_197.sortable=false;function _19a(item){return !grid.allowSelect(grid.row(item));};function _19b(_19c){return function(_19d){var rows=_19d.rows,len=rows.length,_19e="false",_19f,_1a0,i;for(i=0;i<len;i++){var _1a1=grid.cell(rows[i],_197.id).element;if(!_1a1){continue;}_1a1=(_1a1.contents||_1a1).input;if(_1a1&&!_1a1.disabled){_1a1.checked=_19c;_1a1.setAttribute("aria-checked",_19c);}}if(_199.type=="checkbox"){_19f=grid.selection;_1a0=false;for(i in _19f){if(_19f[i]!=grid.allSelected){_1a0=true;break;}}_199.indeterminate=_1a0;_199.checked=grid.allSelected;if(_1a0){_19e="mixed";}else{if(grid.allSelected){_19e="true";}}_199.setAttribute("aria-checked",_19e);}};};function _1a2(_1a3){if(_1a3.type=="click"||_1a3.keyCode==32||(!has("opera")&&_1a3.keyCode==13)||_1a3.keyCode===0){var row=grid.row(_1a3),_1a4=grid._lastSelected&&grid.row(grid._lastSelected);grid._selectionTriggerEvent=_1a3;if(type=="radio"){if(!_1a4||_1a4.id!=row.id){grid.clearSelection();grid.select(row,null,true);grid._lastSelected=row.element;}}else{if(row){if(_1a3.shiftKey){_19b(true)({rows:[row]});}else{_1a4=null;}_1a4=_1a3.shiftKey?_1a4:null;grid.select(_1a4||row,row,_1a4?undefined:null);grid._lastSelected=row.element;}else{put(this,(grid.allSelected?"!":".")+"dgrid-select-all");grid[grid.allSelected?"clearSelection":"selectAll"]();}}grid._selectionTriggerEvent=null;}};function _1a5(){grid._hasSelectorInputListener=true;_198.push(grid.on(".dgrid-selector:click,.dgrid-selector:keydown",_1a2));var _1a6=grid._handleSelect;grid._handleSelect=function(_1a7){if(this.cell(_1a7).column!=_197){_1a6.apply(this,arguments);}};if(typeof _197.disabled=="function"){var _1a8=grid.allowSelect,_1a9=_197.disabled;grid.allowSelect=function(row){var _1aa=_1a8.call(this,row);if(_1a9===_19a){return _1aa;}else{return _1aa&&!_1a9.call(_197,row.data);}};_197.disabled=_19a;}else{_197.disabled=_19a;}_198.push(grid.on("dgrid-select",_19b(true)));_198.push(grid.on("dgrid-deselect",_19b(false)));};var _1ab=typeof type=="function"?type:function(_1ac,cell,_1ad){var _1ae=cell.parentNode,_19a;if(!grid._hasSelectorInputListener){_1a5();}_19a=_197.disabled;put(_1ae&&_1ae.contents?_1ae:cell,".dgrid-selector");var _1af=cell.input||(cell.input=put(cell,"input[type="+type+"]",{tabIndex:isNaN(_197.tabIndex)?-1:_197.tabIndex,disabled:_19a&&(typeof _19a=="function"?_19a.call(_197,_1ad):_19a),checked:_1ac}));_1af.setAttribute("aria-checked",!!_1ac);return _1af;};_196.after(_197,"init",function(){grid=_197.grid;});_196.after(_197,"destroy",function(){_195.forEach(_198,function(l){l.remove();});grid._hasSelectorInputListener=false;});_197.renderCell=function(_1b0,_1b1,cell,_1b2,_1b3){var row=_1b0&&grid.row(_1b0);_1b1=row&&grid.selection[row.id];_1ab(_1b1,cell,_1b0);};_197.renderHeaderCell=function(th){var _1b4="label" in _197?_197.label:_197.field||"";if(type=="radio"||!grid.allowSelectAll){th.appendChild(document.createTextNode(_1b4));if(!grid._hasSelectorInputListener){_1a5();}}else{_1ab(false,th,{});}_199=th.lastChild;};return _197;};});},"epi-cms/widget/_ConfigurableContentListBase":function(){require({cache:{"url:epi-cms/widget/templates/_ConfigurableContentListBase.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>"}});define("epi-cms/widget/_ConfigurableContentListBase",["dojo","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","epi","epi/shell/dgrid/Formatter","epi/shell/dgrid/Keyboard","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/widget/_ContentListBase","dojo/text!./templates/_ConfigurableContentListBase.html","epi-cms/contentediting/StandardToolbar"],function(dojo,_1b5,lang,_1b6,_1b7,_1b8,_1b9,_1ba,_1bb,epi,_1bc,_1bd,DnD,_1be,_1bf,_1c0,_1c1){return _1b5([_1c0,_1b7,_1b8],{_gridClass:_1b5([_1b9,_1bc,_1ba,DnD,_1bd,_1bf,_1bb]),templateString:_1c1,postCreate:function(){this.gridAttachNode=this.gridNode;this.inherited(arguments);},getListSettings:function(){var _1c2=this.getColumnSettings();var _1c3=this.model&&this.model.commands&&this.model.commands.length>0;if(_1c3){_1c2=lang.mixin(_1c2,{contextMenu:{renderHeaderCell:function(node){},formatter:function(){return _1be.menu({title:epi.resources.action.options});},className:"epi-columnNarrow",sortable:false}});}return {columns:_1c2,store:this.store};},getColumnSettings:function(){},_onChangeContext:function(e){var row=this.grid.row(e);if(row){this._requestNewContext({uri:row.data.uri},{sender:this});}},resize:function(_1c4){this.inherited(arguments);if(_1c4){var _1c5=_1c4.h-_1b6.getMarginBox(this.toolbar.domNode).h;_1b6.setContentSize(this.gridNode,{h:_1c5});}},updateView:function(data,_1c6){this.toolbar.update({currentContext:_1c6,viewConfigurations:{availableViews:data.availableViews,viewName:data.viewName}});this.fetchData(_1c6);}});});},"epi/shell/dgrid/Keyboard":function(){define("epi/shell/dgrid/Keyboard",["dojo/_base/declare","dojo/_base/lang","dojo/on","dgrid/Keyboard"],function(_1c7,lang,on,_1c8){return _1c7([_1c8],{postMixInProperties:function(){this.inherited(arguments);this.keyMap=lang.mixin(this.keyMap,this._createCustomKeyMap());},_createCustomKeyMap:function(){return {67:function(_1c9){if(this._isCtrlOrMetaKeyPressed(_1c9)){this._doCopy(_1c9);}},99:function(_1ca){if(this._isCtrlOrMetaKeyPressed(_1ca)){this._doCopy(_1ca);}},88:function(_1cb){if(this._isCtrlOrMetaKeyPressed(_1cb)){this._doCut(_1cb);}},120:function(_1cc){if(this._isCtrlOrMetaKeyPressed(_1cc)){this._doCut(_1cc);}},86:function(_1cd){if(this._isCtrlOrMetaKeyPressed(_1cd)){this._doPaste(_1cd);}},118:function(_1ce){if(this._isCtrlOrMetaKeyPressed(_1ce)){this._doPaste(_1ce);}}};},_isCtrlOrMetaKeyPressed:function(_1cf){return _1cf.ctrlKey||_1cf.metaKey;},_doCopy:function(_1d0){on.emit(this.domNode,"dgrid-rowcopy",_1d0);},_doCut:function(_1d1){on.emit(this.domNode,"dgrid-rowcut",_1d1);},_doPaste:function(_1d2){on.emit(this.domNode,"dgrid-rowpaste",_1d2);}});});},"url:epi-cms/widget/templates/_ConfigurableContentListBase.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-ecf-ui/widget/viewmodel/CatalogContentListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/command/withConfirmation","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/CreateCommandsMixin","epi-cms/component/command/ChangeContext","epi-cms/command/NewContent","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","./CatalogTreeStoreModel","../../command/DetachFromCategory","../../command/PasteCatalogContent","../../component/DeleteCatalogContentHandler","epi/i18n!epi/cms/nls/commerce.widget.catalogcontentlist","epi/i18n!epi/nls/episerver.shared"],function(_1d3,_1d4,lang,_1d5,_1d6,_1d7,_1d8,_1d9,_1da,_1db,_1dc,_1dd,_1de,_1df,_1e0,_1e1,_1e2,_1e3,_1e4,_1e5){return _1d4([_1d6,_1da],{model:null,treeStoreModel:null,res:_1e4,clipboardManager:null,selection:null,_commandRegistry:null,numSelectedRows:null,postscript:function(){this.clipboardManager=this.clipboardManager||new _1d5();this.selection=this.selection||new _1d7();this.repositoryKey="catalog";this.inherited(arguments);this._setupCommands();},getSelectionCommands:function(){return [this._commandRegistry.cut.command,this._commandRegistry.copy.command,this._commandRegistry.pasteOnContext.command,this._commandRegistry.detach.command,this._commandRegistry.remove.command];},_setupCommands:function(){this.treeStoreModel=new _1e0();this.treeStoreModel.roots=this.roots;var _1e6=_1d9(this.treeStoreModel);var _1e7={category:"context",clipboard:this.clipboardManager,selection:this.selection,model:_1e6};var _1e8=lang.mixin({toolbarGroup:"clipboard"},_1e7);var _1e9=new _1df(lang.mixin({model:this.treeStoreModel},_1e7));this._commandRegistry=lang.mixin(this.getCreateCommands(),{edit:{command:new _1db({category:"context",forceContextChange:true,viewName:"formedit"}),order:-1},cut:{command:new _1de(_1e8),order:101},copy:{command:new _1dd(_1e8),order:102},paste:{command:new _1e2(_1e7),order:103},pasteOnContext:{command:new _1e2(lang.mixin(_1e8,{selection:new _1d7()}))},detach:{command:_1d8(new _1e1(_1e7),null,{title:this.res.detachconfirmation.title,description:this.res.detachconfirmation.description}),order:104},remove:{command:_1d8(_1e9,_1e3,{title:this.res.deleteconfirmation.title,description:this.res.deleteconfirmation.description,confirmActionText:_1e5.action.deletelabel,cancelActionText:_1e5.action.cancel}),order:105},sort:function(){var _1ea=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)&&key!=="pasteOnContext"){var _1eb=this[key].order;if(!_1eb){_1eb=100;}_1ea.push([_1eb,this[key].command]);}}_1ea.sort(function(a,b){return a[0]-b[0];});return _1ea;},toArray:function(){var _1ec=this.sort();var _1ed=[];_1d3.forEach(_1ec,function(key){_1ed.push(key[1]);});return _1ed;}});this.set("commands",this._commandRegistry.toArray());},_modelSetter:function(_1ee){this.model=_1ee;var _1ef=_1ee;if(_1ee&&_1ee.data){_1ef=_1ee.data;}this._commandRegistry.edit.command.set("model",_1ef);for(var cmd in this._commandRegistry){var _1f0=this._commandRegistry[cmd].command||{};if(_1f0 instanceof _1dc||_1f0.popup){_1f0.set("model",_1ef);}}this.updateSelection(_1ef);},updateSelection:function(_1f1){var _1f2=[];if(_1f1){this.numSelectedRows=_1f1.length;_1f2=_1d3.map(_1f1,function(item){return {type:"epi.cms.contentdata",data:item,contextId:this.model?this.model.contextId:null};},this);}if(this.selection){this.selection.set("data",_1f2);}},destroy:function(){this.treeStoreModel.destroy();delete this.treeStoreModel;}});});},"epi-ecf-ui/command/DetachFromCategory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi-cms/core/ContentReference","../contentediting/ModelSupport","epi/i18n!epi/cms/nls/commerce.command.detachfromcategory"],function(_1f3,_1f4,lang,_1f5,_1f6,_1f7,when,_1f8,_1f9,_1fa,_1fb,_1fc,_1fd,_1fe,res){return _1f4([_1f9,_1fa],{label:res.label,categoryLink:null,iconClass:"epi-iconDetach",_store:null,postscript:function(){this.inherited(arguments);var _1ff=_1f8.resolve("epi.storeregistry");this._store=this._store||_1ff.get("epi.commerce.relation");},_execute:function(){var _200=this.categoryLink||when(this.model.currentContentService.getCurrentContext(),lang.hitch(this,function(_201){return _201.id;}));var _202=new _1fd(_200).createVersionUnspecificReference();var _203=_1f3.map(this.selection.data,function(_204){return when(this._store.query(this._getQuery(_204.data.contentLink)),lang.hitch(this,function(_205){return _1f6(_1f3.map(_205,function(_206){var _207=new _1fd(_206.target);if(_207.id===_202.id){return this._store.remove(_206.id).then(function(){_1f7.publish("relationChanged",_206);});}},this));}));},this);_1f6(_203);},_onModelChange:function(){var _208=[];var _209=this.selection.data.length>0;_1f3.forEach(this.selection.data,function(_20a){var _20b=new _1f5();_208.push(_20b.promise);if(_20a.type!=="epi.cms.contentdata"){_20b.resolve(false);}if(!this.isUsedByCollectionEditor){when(this.model.currentContentService.getCurrentContext(),lang.hitch(this,function(_20c){if(_1fd.compareIgnoreVersion(_20a.data.parentLink,_20c.id)){_20b.resolve(false);}}));}when(this._store.query(this._getQuery(_20a.data.contentLink)),lang.hitch(this,function(_20d){if(this._typeIsAssignableFrom(_20a.data.typeIdentifier,_1fe.contentTypeIdentifier.nodeContentBase)){_20b.resolve(_20d.length>0);}_20b.resolve(_20d.length>1);}));},this);_1f6(_208).then(lang.hitch(this,function(_20e){var _20f=_1f3.some(_20e,function(_210){return !_210;});this.set("canExecute",_209&&!_20f);}));},_typeIsAssignableFrom:function(type,_211){return _1fb.isBaseTypeIdentifier(type,_211);},_getQuery:function(_212){return {referenceId:_212,relationTypes:[_1fe.relationType.node]};}});});},"epi-ecf-ui/command/PasteCatalogContent":function(){define(["dojo/_base/declare","epi/shell/TypeDescriptorManager","epi-cms/command/PasteContent","../contentediting/ModelSupport"],function(_213,_214,_215,_216){return _213([_215],{typeDescriptorManager:_214,_onModelChange:function(){var _217=this.get("selectionData");if(_217&&this._typeIsAssignableFrom(_217.typeIdentifier,_216.contentTypeIdentifier.nodeContentBase)){this.inherited(arguments);this.set("isAvailable",true);return;}this._hideCommand();},_typeIsAssignableFrom:function(type,_218){return this.typeDescriptorManager.isBaseTypeIdentifier(type,_218);},_hideCommand:function(){this.set("isAvailable",false);}});});},"epi-ecf-ui/widget/CommandToolbar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/Toolbar","dijit/layout/_LayoutWidget","dijit/form/DropDownButton","epi/shell/widget/_AddByDefinition"],function(_219,_21a,lang,all,when,_21b,_21c,_21d,_21e){return _21a([_21c,_21b,_21e],{_commands:null,constructor:function(_21f){this._commands=_21f;},buildRendering:function(){this.inherited(arguments);when(this.setupChildren(),lang.hitch(this,function(){this.resize();}));},setupChildren:function(){var _220=[{name:"clipboard",type:"toolbargroup",parent:"leading",settings:{"class":"epi-groupedButtonContainer dijitInline"}}];_220=_220.concat(_219.map(this._commands,function(_221,_222){return {name:"command"+_222,widgetType:"epi-ecf-ui/widget/CommandButton",parent:_221.toolbarGroup,settings:{model:_221,"class":"epi-flatButton epi-chromelessButton"},title:_221.label};}));return this.add(_220);}});});},"epi-ecf-ui/widget/MarketSelector":function(){define(["dojo/_base/declare","dijit/form/Select","epi/dependency"],function(_223,_224,_225){return _223([_224],{keyProfileSetting:"market",addDefaultItem:true,excludeCurrencies:true,excludeInactive:true,postMixInProperties:function(){this.inherited(arguments);this.labelAttr="label";this.sortByLabel=false;this.store=this.store||_225.resolve("epi.storeregistry").get("epi.commerce.market");this.query={addDefaultItem:this.addDefaultItem,excludeCurrencies:this.excludeCurrencies,excludeInactive:this.excludeInactive};}});});},"url:epi-ecf-ui/widget/templates/CatalogContentList.html":"<div class=\"epi-catalogContentList\">\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div class=\"epi-localToolbar epi-flatToolbar\">\r\n        <div class=\"epi-toolbarGroupContainer\">\r\n            <div class=\"epi-toolbarGroup epi-toolbarLeading\" data-dojo-attach-point=\"leadingNode\"></div>\r\n            <div class=\"epi-toolbarGroup epi-toolbarCenter\" data-dojo-attach-point=\"centerNode\"></div>\r\n            <div class=\"epi-toolbarGroup epi-toolbarTrailing\" data-dojo-attach-point=\"trailingNode\">\r\n                <label for=\"markets\">${resources.market}</label>\r\n                <select name=\"markets\" data-dojo-type=\"epi-ecf-ui/widget/MarketSelector\" data-dojo-attach-point=\"marketSelector\" data-dojo-attach-event='onChange: _onMarketChanged' class=\"epi-chromelessSelect epi-flatSelect\"></select>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-ecf-ui/widget/CatalogList":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/html","dojo/topic","dojo/dom-class","epi","epi/dependency","epi/shell/widget/_FocusableMixin","epi-cms/dgrid/formatters","epi-cms/widget/_ConfigurableContentListBase","epi/i18n!epi/cms/nls/commerce.widget.cataloglist"],function(dojo,_226,lang,html,_227,_228,epi,_229,_22a,_22b,_22c,res){return _226([_22c,_22a],{contextChangeEvent:"click",startup:function(){this.inherited(arguments);this.own(_227.subscribe("relationChanged",lang.hitch(this,function(){this.grid.refresh();})));},buildRendering:function(){this.baseClass="epi-plain-grid";this.inherited(arguments);},fetchData:function(_22d){var _22e={ignore:["query"],parentId:_22d.id,sort:[{attribute:"name"}]};var _22f={referenceId:_22d.id,query:"getchildren",includeProperties:true,allLanguages:true};this.grid.set("query",_22f,_22e);},getColumnSettings:function(){return {typeSortIndex:{renderHeaderCell:function(node){},get:function(_230){return _230.typeIdentifier;},formatter:_22b.contentIcon,className:"epi-columnIcon16x16",sortable:false,renderCell:function(_231,_232,node,_233){_228.add(node,"epi-columnPadding--left");node.innerHTML=_22b.contentIcon(_232);}},name:{label:epi.resources.header.name,className:"epi-columnWide"},language:{get:function(_234){return _234.properties.defaultLanguage;},label:epi.resources.header.language,sortable:false},currency:{get:function(_235){return _235.properties.defaultCurrency;},label:epi.resources.header.currency,sortable:false},baseWeight:{get:function(_236){return _236.properties.weightBase;},label:res.baseweight,sortable:false},isPendingPublish:{get:function(_237){return !_237.isPendingPublish;},label:res.active,formatter:_22b.friendlyBoolean,className:"epi-columnNarrow"},startPublish:{get:function(_238){return _238.properties.startPublish;},label:res.availablefrom,formatter:this._localizedDateAndSecondaryText},stopPublish:{get:function(_239){return _239.properties.stopPublish;},label:epi.resources.header.expires,formatter:this._localizedDateAndSecondaryText},owner:{get:function(_23a){return _23a.properties.owner;},label:epi.resources.header.owner,formatter:_22b.secondaryText,sortable:false}};},_localizedDateAndSecondaryText:function(_23b){return _22b.secondaryText(_22b.localizedDate(_23b),true);}});});},"epi-ecf-ui/widget/CommandButton":function(){define(["dojo/_base/declare","dijit/form/Button","epi/shell/command/_CommandModelBindingMixin"],function(_23c,_23d,_23e){return _23c([_23d,_23e]);});},"epi-ecf-ui/widget/LinkEdit":function(){define(["dojo/_base/declare","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","../contentediting/editors/CategoryCollectionEditor","../contentediting/editors/AssociationCollectionEditor","../contentediting/ModelSupport","./_RelationViewBase","dojo/text!./templates/LinkEdit.html","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/StandardToolbar"],function(_23f,_240,_241,_242,_243,_244,_245,_246,_247,_248,_249,_24a){return _23f([_249,_240,_241,_242],{templateString:_24a,contentPane:this.contentPane,updateView:function(data,_24b){this.inherited(arguments);this._setupAssociationsList(_24b);this.set("value",_24b.id);},_setupAssociationsList:function(_24c){if(_243.isBaseTypeIdentifier(_24c.dataType,_248.contentTypeIdentifier.entryContentBase)){if(!this.associationList){this.associationList=new _247();this.own(this.associationList);this.associationList.placeAt(this.associationListNode);}}else{if(this.associationList){this.associationList.destroy();delete this.associationList;}}},_setValueAttr:function(_24d){this.categoryList.set("value",_24d);if(this.associationList){this.associationList.set("value",_24d);}}});});},"epi-ecf-ui/contentediting/editors/CategoryCollectionEditor":function(){define(["dojo/_base/declare","dojo/topic","epi/shell/widget/_FocusableMixin","./_RelationCollectionEditorBase","../viewmodel/CategoryCollectionEditorModel","./LinkEditEditor","../ModelSupport","epi/i18n!epi/cms/nls/commerce.contentediting.editors.categorycollectioneditor"],function(_24e,_24f,_250,_251,_252,_253,_254,_255){var _256=_24e([_251,_250],{modelType:_252,allowedDndTypes:[_254.contentTypeIdentifier.nodeContent,_254.linkTypeIdentifier.relation],itemEditorTypes:[_254.contentTypeIdentifier.nodeContent],resources:_255,relationType:_254.relationType.node});return _24e([_253],{resources:_255,gridCollectionType:_256,executeAction:function(_257){_24f.publish("/epi/layout/pinnable/navigation/toggle",true);}});});},"epi-ecf-ui/contentediting/editors/_RelationCollectionEditorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","dojo/aspect","dojo/dom-construct","dojo/dom-class","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","epi/dependency","epi/shell/dgrid/Formatter","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ContentSelectorDialog","./RelationCollectionGridAssembler","../ModelSupport","./LinkEditorDndMixin","../../dgrid/_ClickablePathColumnMixin"],function(_258,lang,_259,when,_25a,_25b,_25c,_25d,_25e,_25f,_260,_261,_262,_263,_264,_265,DnD,_266,_267,_268,_269,_26a,_26b){return _258([_264,_26a],{templateString:"<div>                            <div data-dojo-attach-point=\"commandTargetNode\"></div>                            <div data-dojo-attach-point=\"overlayDnd\">                                <div class=\"epi-associationCollectionEditor\" data-dojo-attach-point=\"gridNode\"></div>                            <div>                        </div>",resources:null,gridOverlayClass:"epi-grid-dnd-overlay",itemType:"EPiServer.Commerce.AddOns.UI.Rest.Models.RelationModel",itemEditorTypes:null,storeKey:"epi.commerce.relation",itemEditorType:_267,commands:_265.commandMask.remove,gridAssemblerType:_268,gridType:_258([_25e,_263,_25f,_25d,DnD,_260,_261,_266,_26b]),postMixInProperties:function(){this.inherited(arguments);var _26c=_262.resolve("epi.storeregistry");this._store=this._store||_26c.get(this.storeKey);if(!this.roots){var _26d=_262.resolve("epi.cms.contentRepositoryDescriptors");var _26e=_26d["catalog"];this.roots=_26e.roots;}this.gridSettings=lang.mixin(this.gridSettings||{},{useDeleteWithConfirmation:true,dndSourceTypes:[_269.linkTypeIdentifier.relation],deleteConfirmationTitle:this.resources.deleteconfirmation.title,deleteConfirmationMessage:this.resources.deleteconfirmation.description});},_dndNodeCreator:function(item,hint){var _26f=this.allowedDndTypes,node=_25b.create("div").appendChild(document.createTextNode(item.name));return {"node":node,"type":_26f,"data":item};},onExecuteDialog:function(){var _270=this._itemEditor.get("value");this.model.addItem(this._createItem(_270));},_renderNoDataMessage:function(){this.grid.set("noDataMessage",this.resources.nodatamessage);this.inherited(arguments);},_getDialogTitleText:function(){return this.resources.addlabel;},_createItemEditor:function(){return new this.itemEditorType({canSelectOwnerContent:false,showButtons:false,roots:this.roots,allowedTypes:this.itemEditorTypes,showAllLanguages:false});},_dndGetItemData:function(item){return when(item.data,lang.hitch(this,function(data){if(data){return this._createItem(data.contentLink,data.name);}}));},_createItem:function(_271,name){return {name:name||_271,sortOrder:0,source:this.model.get("data"),target:_271,type:this.relationType};},_setupDnD:function(){this.inherited(arguments);this.setupDndActions(this.grid.dndSource,"checkAcceptance");this.own(_25a.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_272,_273,copy){var _274=this.grid.dndSource,_275=_274.accept&&_274.checkAcceptance(_272,_273);_25c[_275?"add":"remove"](this.overlayDnd,this.gridOverlayClass);}),true));}});});},"epi-ecf-ui/contentediting/editors/RelationCollectionGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/when","epi/shell/selection","epi/shell/command/builder/ButtonBuilder","epi-cms/_ContentContextMixin","epi-cms/contentediting/editors/DefaultGridAssembler"],function(_276,_277,when,_278,_279,_27a,_27b){return _277([_27b,_27a],{renderActionMenu:function(item,node,_27c){var _27d=new _279({settings:{showLabel:false}});_276.forEach(_27c,function(_27e){_27d.create(_27e,node);});}});});},"epi-ecf-ui/contentediting/editors/LinkEditorDndMixin":function(){define(["dojo/aspect","dojo/_base/declare","dojo/_base/lang","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_27f,_280,lang,_281,_282){return _280([_281],{setupDndActions:function(_283,func){if(func=="checkAcceptance"){this.own(_27f.around(_283,func,lang.hitch(this,function(_284){return lang.hitch(this,function(_285,_286){var _287=_286.map(function(node){return _285.getItem(node.id).data.item;});var item=_287[0];if(this._currentContext&&item&&_282.compareIgnoreVersion(this._currentContext.id,item.contentLink)){return false;}return _284.apply(_283,arguments);});})));}}});});},"epi-ecf-ui/dgrid/_ClickablePathColumnMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","epi/shell/DestroyableByKey"],function(_288,lang,_289,_28a,_28b){return _288([_28b],{postCreate:function(){this.inherited(arguments);this._setupClickablePathColumn();},_setupClickablePathColumn:function(){this.ownByKey("pathColumnClick",this.on(".dgrid-cell.dgrid-column-path:click",lang.hitch(this,function(_28c){var row=this.row(_28c);_28a.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+row.data.target},{sender:this});})));for(var _28d in this.columns){if(_28d=="path"){this.columns[_28d].className="epi-ecf-uiPathLink";}}}});});},"epi-ecf-ui/contentediting/viewmodel/CategoryCollectionEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/selection","epi-cms/contentediting/editors/model/CollectionEditorModel","./CategoryCollectionReadOnlyEditorModel","./_RelationCollectionEditorModelMixin","../../command/DetachFromCategory","epi/i18n!epi/nls/episerver.shared","epi/i18n!epi/cms/nls/commerce.contentediting.editors.categorycollectioneditor"],function(_28e,lang,_28f,when,_290,_291,_292,_293,_294,_295,res){return _28e([_292,_293],{res:res,getItemCommands:function(item,_296,_297){var _298=this.inherited(arguments);if(_298){for(var i=0;i<_298.length;i++){if(_298[i].name=="remove"){var _299=_298[i];var _29a=new _294({name:_299.name,category:_299.category,label:_299.label,iconClass:_299.iconClass,selection:new _290(),categoryLink:item.target,isUsedByCollectionEditor:true});when(this.getCurrentContent(),function(_29b){_29a.selection.data=[{data:_29b,type:"epi.cms.contentdata"}];_29a.set("model",{});});_298[i]=_29a;}}}return _298;},addItem:function(item,_29c,_29d){return when(this.inherited(arguments),function(){_28f.publish("relationChanged",item);});}});});},"epi-ecf-ui/contentediting/viewmodel/_RelationCollectionEditorModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","dojo/_base/json","dojox/html/entities","epi/shell/command/DelegateCommand","epi/shell/widget/dialog/Alert","epi/string","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(_29e,_29f,lang,_2a0,_2a1,when,json,_2a2,_2a3,_2a4,_2a5,_2a6,_2a7){return _29f([],{res:null,postscript:function(){this.inherited(arguments);this.own(_2a1.subscribe("relationChanged",lang.hitch(this,this._refresh)));},generateColumnsDefinition:function(){return {contentTypeIdentifier:{label:"",className:"epi-columnIcon16x16",formatter:lang.hitch(this,_2a6.contentIcon)},name:{label:this.res.headings.name},path:{label:this.res.headings.path}};},getItemCommands:function(){var _2a8=this.inherited(arguments);if(_2a8){for(var i=0;i<_2a8.length;i++){if(_2a8[i].name=="remove"){_2a8[i].iconClass="epi-iconClose";}}}return _2a8;},getListCommands:function(_2a9){return [new _2a3({name:"add",label:this.res.addlabel,tooltip:_2a7.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:true,delegate:lang.hitch(this,this.addItemDelegate)})];},addItem:function(item,_2aa,_2ab){var _2ac=this.get("items");if(_2ac&&_2ac.length>0){var _2ad=item.permanentUrl||item.target;var _2ae;_29e.some(_2ac,function(_2af){if(_2af&&_2af.target==_2ad){_2ae=_2af;return true;}});if(_2ae){this.moveItem(_2ae,_2aa||_2ae,_2ab||true);return this._refresh();}}this._setSortOrder(item,_2aa,_2ab);return when(this.inherited(arguments),lang.hitch(this,function(){return when(this._store.add(item),lang.hitch(this,function(){return this._refresh();}),lang.hitch(this,function(_2b0){return this._showNotification(_2b0);}));}));},moveItem:function(item,_2b1,_2b2){return when(this.inherited(arguments),lang.hitch(this,function(){this._setSortOrder(item,_2b1,_2b2);return when(this._store.put(item),lang.hitch(this,function(){return this._refresh();}),lang.hitch(this,function(_2b3){return this._showNotification(_2b3);}));}));},removeItem:function(item){return when(this.inherited(arguments),lang.hitch(this,function(){return when(this._store.remove(item.id),lang.hitch(this,function(){return this._refresh();}),lang.hitch(this,function(_2b4){return this._showNotification(_2b4);}));}));},saveItem:function(item,_2b5){return when(this.inherited(arguments),lang.hitch(this,function(){return when(this._store.put(item),lang.hitch(this,function(){return this._refresh();}),lang.hitch(this,function(_2b6){return this._showNotification(_2b6);}));}));},_showNotification:function(_2b7){if(_2b7.status===400){var _2b8=new _2a4({destroyOnHide:true,description:_2a5.toHTML(_2a2.encode(json.fromJson(_2b7.xhr.responseText))),onAction:lang.hitch(this,function(){this._refresh();})});_2b8.show();}},_refresh:function(){this.set("data",this.get("data"));},_setSortOrder:function(item,_2b9,_2ba){if(_2b9){item.sortOrder=_2ba?_2b9.sortOrder:_2b9.sortOrder+1;}else{var _2bb=this.get("items");var _2bc=(_2bb.length>0)?_2bb[_2bb.length-1].sortOrder:0;if(!item.sortOrder||_2bc>=item.sortOrder){item.sortOrder=_2bc+100;}}}});});},"epi-ecf-ui/contentediting/editors/LinkEditEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/_Widget","dijit/_TemplatedMixin","epi/shell/dnd/Target","epi-cms/contentediting/editors/_TextWithActionLinksMixin","./LinkEditorDndMixin","dojo/text!./templates/LinkEditEditor.html"],function(_2bd,lang,_2be,_2bf,_2c0,_2c1,_2c2,_2c3,_2c4){return _2bd([_2bf,_2c0,_2c2,_2c3],{templateString:_2c4,gridCollectionType:null,gridCollection:null,_dndTarget:null,buildRendering:function(){this.inherited(arguments);this.gridCollection=this.gridCollectionType();this._dndTarget=new _2c1(this.dropContainer,{accept:this.gridCollection.allowedDndTypes,insertNodes:function(){}});this.own(_2be.after(this._dndTarget,"onDropData",lang.hitch(this,function(_2c5){this.gridCollection._addItem(_2c5[0],true);}),true));this.setupDndActions(this._dndTarget,"checkAcceptance");this.own(this.gridCollection);this.collectionList.appendChild(this.gridCollection.domNode);},postCreate:function(){this.inherited(arguments);this.setupActionLinks(this.dropContainer);},getTemplateString:function(){return {templateString:this.resources.drophere,actions:this.resources.actions};},updateView:function(data){this.set("value",data.value);},_setValueAttr:function(_2c6){this.gridCollection.set("value",_2c6);}});});},"url:epi-ecf-ui/contentediting/editors/templates/LinkEditEditor.html":"<div class=\"epi-linkeditcollectionediteditor\">\r\n    <h1>${resources.title}</h1>\r\n    <div data-dojo-attach-point=\"collectionList\"></div>\r\n    <div data-dojo-attach-point=\"dropContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n</div>","epi-ecf-ui/contentediting/editors/AssociationCollectionEditor":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/_base/lang","dojo/Stateful","dojo/when","dojo/topic","dijit/_TemplatedMixin","dijit/_Widget","dgrid/editor","dgrid/OnDemandGrid","dgrid/Selection","epi/shell/_ContextMixin","epi/shell/dgrid/_EditorMetadataMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/dialog/Confirmation","epi/dependency","epi/string","epi-cms/contentediting/editors/_AddItemDialogMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentSelectorDialog","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/dgrid/DnD","../viewmodel/AssociationCollectionEditorModel","../../store/CompositeKey","./LinkEditEditor","./_CollectionEditorDndMixin","../../dgrid/_ClickablePathColumnMixin","../ModelSupport","epi/i18n!epi/cms/nls/commerce.contentediting.editors.associationcollectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_2c7,_2c8,_2c9,_2ca,_2cb,lang,_2cc,when,_2cd,_2ce,_2cf,_2d0,Grid,_2d1,_2d2,_2d3,_2d4,_2d5,_2d6,_2d7,_2d8,_2d9,_2da,_2db,_2dc,_2dd,_2de,DnD,_2df,_2e0,_2e1,_2e2,_2e3,_2e4,_2e5,_2e6){var _2e7=_2c9([_2cf,_2ce,_2d5,_2da,_2d4,_2e2,_2d2],{templateString:"<div>                            <div data-dojo-attach-point=\"commandTargetNode\"></div>                            <div data-dojo-attach-point=\"overlayDnd\">                                <div class=\"epi-associationCollectionEditor\" data-dojo-attach-point=\"gridNode\"></div>                            </div>                        </div>",grid:null,gridOverlayClass:"epi-grid-dnd-overlay",modelType:_2df,itemType:"EPiServer.Commerce.AddOns.UI.Rest.Models.AssociationModel",allowedDndTypes:[_2e4.contentTypeIdentifier.entryContentBase,_2e4.linkTypeIdentifier.association],includedColumns:["ContentTypeIdentifier","Name","Code","Path","GroupName"],editableColumns:["GroupName"],cellActionName:"epiGridAction",itemEditorType:_2dc,postMixInProperties:function(){this.model=this.model||new this.modelType({itemType:this.itemType});},postCreate:function(){this.inherited(arguments);if(!this.roots){var _2e8=_2d8.resolve("epi.cms.contentRepositoryDescriptors"),_2e9=_2e8.catalog;this.roots=_2e9.roots;}var _2ea=new _2d6({settings:{showLabel:true}}),_2eb=this.model.getListCommand();_2ea.create(_2eb,this.commandTargetNode);var _2ec=_2c9([Grid,_2d1,_2d0,_2d3,_2de,DnD,_2e3],{});when(this.model.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_2ed){var _2ee=[{field:"contentTypeIdentifier",renderHeaderCell:function(){},get:function(_2ef){return _2ef.contentTypeIdentifier;},label:"",formatter:_2dd.contentIcon,className:"epi-columnIcon16x16",sortable:false},{field:this.cellActionName,renderHeaderCell:function(){},renderCell:lang.hitch(this,function(_2f0,_2f1,node,_2f2){var _2f3=new _2d6({settings:{showLabel:false}}),_2f4=this.model.getCommands(this.grid,null);_2c7.forEach(_2f4,function(_2f5){_2f3.create(_2f5,node);});}),className:"epi-columnNarrow",sortable:false}],_2f6=["groupName","type"],_2f7=new _2e0(_2d8.resolve("epi.storeregistry").get("epi.commerce.association"),_2f6,true),grid=this.grid=new _2ec({store:_2f7,minWidth:100,noDataMessage:_2e5.nodatamessage,selectionMode:"single","class":"epi-plain-grid epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders",columns:_2ee,metadata:{properties:_2ed.properties,gridIncluded:this.includedColumns,gridEditable:this.editableColumns},dndSourceTypes:[_2e4.linkTypeIdentifier.association],dndParams:{copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)}});_2cb.place(this.grid.domNode,this.gridNode);this.own(grid,_2f7,_2c8.after(_2f7,"removeReAdd",function(_2f8){when(_2f8,function(){grid.refresh();});}),this.model.on("itemAdded",lang.hitch(this,function(){this.grid.refresh();})),this.model.on("itemSaved",lang.hitch(this,function(){this.grid.refresh();})),this.model.on("itemRemoved",lang.hitch(this,function(){this.grid.refresh();})),this.model.watch("contentLink",lang.hitch(this,function(_2f9,_2fa,_2fb){if(_2fa!==_2fb){this._updateGridQuery(_2fb);grid.resize();}})),this.model.on("removeCommandEvent",lang.hitch(this,function(){when(this._showConfirmation(_2e5.deleteconfirmation.title,_2e5.deleteconfirmation.description),lang.hitch(this,function(){if(this.model){var _2fc=[];for(var _2fd in this.grid.selection){if(this.grid.selection.hasOwnProperty(_2fd)){_2fc.push(this.model.store.get(_2fd));}}return this.model.removeItems(_2fc);}}));})));this._setupDnD();when(this.getCurrentContext(),lang.hitch(this,function(_2fe){this._updateGridQuery(_2fe.id);this.grid.startup();}));}));},_updateGridQuery:function(_2ff){this.grid.set("query",{referenceId:new _2db(_2ff).createVersionUnspecificReference().toString()});},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_300){if(_300){return this.model.addItem(_300);}}));},_noDataMessage:_2e5.nodatamessage,resize:function(){this.inherited(arguments);if(this.grid){this.grid.resize();}},_getDialogTitleText:function(){return _2e5.addlabel;},_createItemEditor:function(){return new this.itemEditorType({canSelectOwnerContent:false,showButtons:false,roots:this.roots,allowedTypes:[_2e4.contentTypeIdentifier.entryContentBase],showAllLanguages:false});},_dndGetItemData:function(item){return when(item.data,lang.hitch(this,function(data){if(data){return this._createItem(data.contentLink,data.name);}}));},_createItem:function(_301,name){return {name:name||_301,sortOrder:0,source:this.model.get("contentLink"),target:_301};},onExecuteDialog:function(){var item=this._itemEditor.get("value");this._addItem({data:{contentLink:item}},true);},_setValueAttr:function(_302){this._set("value",_302);if(this.model){this.model.set("contentLink",_302);}},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},_showConfirmation:function(_303,_304){var _305=new _2ca();var _306=new _2d7({destroyOnHide:true,title:_2d9.toHTML(_303),description:_2d9.toHTML(_304),onAction:function(_307){if(_307){_305.resolve();}else{_305.cancel();}}});_306.show();return _305.promise;}});return _2c9([_2e1],{resources:_2e5,gridCollectionType:_2e7,executeAction:function(_308){_2cd.publish("/epi/layout/pinnable/tools/toggle",true);}});});},"dgrid/editor":function(){define("dgrid/editor",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/on","dojo/aspect","dojo/has","dojo/query","./Grid","put-selector/put","dojo/_base/sniff"],function(_309,lang,_30a,_30b,on,_30c,has,_30d,Grid,put){var _30e,_30f,_310;function _311(_312,_313){_312.value=_313;if(_312.type=="radio"||_312.type=="checkbox"){_312.checked=_312.defaultChecked=!!_313;}};function _314(_315,_316){if(typeof _316=="number"){_315=isNaN(_315)?_315:parseFloat(_315);}else{if(typeof _316=="boolean"){_315=_315=="true"?true:_315=="false"?false:_315;}else{if(_316 instanceof Date){var _317=new Date(_315);_315=isNaN(_317.getTime())?_315:_317;}}}return _315;};function _318(_319,cmp){if(typeof cmp.get=="function"){return _314(cmp.get("value"));}else{return _314(cmp[cmp.type=="checkbox"||cmp.type=="radio"?"checked":"value"]);}};function _31a(grid,_31b,_31c,_31d,_31e){var cell,row,_31f,_320;if((_31c&&_31c.valueOf())!=(_31d&&_31d.valueOf())){cell=grid.cell(_31b);row=cell.row;_31f=cell.column;if(_31f.field&&row){_320={grid:grid,cell:cell,rowId:row.id,oldValue:_31c,value:_31d,bubbles:true,cancelable:true};if(_31e&&_31e.type){_320.parentType=_31e.type;}if(on.emit(_31b,"dgrid-datachange",_320)){if(grid.updateDirty){grid.updateDirty(row.id,_31f.field,_31d);_31f.autoSave&&setTimeout(function(){grid._trackError("save");},0);}else{row.data[_31f.field]=_31d;}}else{var cmp;if(cmp=_31b.widget){cmp._dgridIgnoreChange=true;cmp.set("value",_31c);setTimeout(function(){cmp._dgridIgnoreChange=false;},0);}else{if(cmp=_31b.input){_311(cmp,_31c);}}return _31c;}}}return _31d;};function _321(grid,_322,cmp,_323){var _324,id,_325;if(!cmp.isValid||cmp.isValid()){_324=_31a(grid,(cmp.domNode||cmp).parentNode,_30e?_30f:cmp._dgridLastValue,_318(_322,cmp),_323);if(_30e){_30f=_324;}else{cmp._dgridLastValue=_324;}if(cmp.type==="radio"&&cmp.name&&!_322.editOn&&_322.field){_325=grid.row(cmp);_30d("input[type=radio][name="+cmp.name+"]",grid.contentNode).forEach(function(_326){var row=grid.row(_326);if(_326!==cmp&&_326._dgridLastValue){_326._dgridLastValue=false;if(grid.updateDirty){grid.updateDirty(row.id,_322.field,false);}else{row.data[_322.field]=false;}}});for(id in grid.dirty){if(_325.id!==id&&grid.dirty[id][_322.field]){grid.updateDirty(id,_322.field,false);}}}}};function _327(_328){var _329=_328.editor,_32a=_328.editOn,grid=_328.grid,_32b=typeof _329!="string",args,cmp,node,_32c,_32d;args=_328.editorArgs||{};if(typeof args=="function"){args=args.call(grid,_328);}if(_32b){cmp=new _329(args);node=cmp.focusNode||cmp.domNode;node.className+=" dgrid-input";cmp.connect(cmp,_32a?"onBlur":"onChange",function(){if(!cmp._dgridIgnoreChange){_321(grid,_328,this,{type:"widget"});}});}else{_32d=function(evt){var _32e=evt.target;if("_dgridLastValue" in _32e&&_32e.className.indexOf("dgrid-input")>-1){_321(grid,_328,_32e,evt);}};if(!_328.grid._hasInputListener){grid._hasInputListener=true;grid.on("change",function(evt){_32d(evt);});}_32c=_329=="textarea"?"textarea":"input[type="+_329+"]";cmp=node=put(_32c+".dgrid-input",lang.mixin({name:_328.field,tabIndex:isNaN(_328.tabIndex)?-1:_328.tabIndex},args));if(has("ie")<9||(has("ie")&&has("quirks"))){if(_329=="radio"||_329=="checkbox"){on(cmp,"click",function(evt){_32d(evt);});}else{on(cmp,"change",function(evt){_32d(evt);});}}}on(node,"mousedown",function(evt){evt.stopPropagation();});return cmp;};function _32f(_330,_331){var cmp=_327(_330),grid=_330.grid,_332=cmp.domNode,node=cmp.domNode||cmp,_333=cmp.focusNode||node,_334=_332?function(){cmp.set("value",cmp._dgridLastValue);}:function(){_311(cmp,cmp._dgridLastValue);_321(_330.grid,_330,cmp);},_335;function blur(){var _336=_30e;_333.blur();if(typeof grid.focus==="function"){setTimeout(function(){grid.focus(_336);},_332&&has("ie")<9?15:0);}};function _337(){var _338=node.parentNode,i=_338.children.length-1,_339={alreadyHooked:true},cell=grid.cell(node);on.emit(cell.element,"dgrid-editor-hide",{grid:grid,cell:cell,column:_330,editor:cmp,bubbles:true,cancelable:false});_330._editorBlurHandle.pause();_338.removeChild(node);put(cell.element,"!dgrid-cell-editing");while(i--){put(_338.firstChild,"!");}Grid.appendIfNode(_338,_330.renderCell(_330.grid.row(_338).data,_30f,_338,_310?lang.delegate(_339,_310):_339));_30e=_30f=_310=null;};function _33a(evt){var key=evt.keyCode||evt.which;if(key==27){_334();_30f=cmp._dgridLastValue;blur();}else{if(key==13&&_330.dismissOnEnter!==false){blur();}}};_335=on(_333,"keydown",_33a);(_330._editorBlurHandle=on.pausable(cmp,"blur",_337)).pause();return cmp;};function _33b(cmp,_33c,_33d,_33e){var _33f=cmp.domNode,grid=_33c.grid;if(!_33f){_311(cmp,_33e);}_33d.innerHTML="";put(_33d,".dgrid-cell-editing");put(_33d,cmp.domNode||cmp);if(_33f){if(!cmp._started){cmp.startup();}cmp._dgridIgnoreChange=true;cmp.set("value",_33e);setTimeout(function(){cmp._dgridIgnoreChange=false;},0);}cmp._dgridLastValue=_33e;if(_30e){_30f=_33e;on.emit(_33d,"dgrid-editor-show",{grid:grid,cell:grid.cell(_33d),column:_33c,editor:cmp,bubbles:true,cancelable:false});}};function edit(cell){var row,_340,_341,_342,_343,_344,cmp,dfd;if(!cell.column){cell=this.cell(cell);}if(!cell||!cell.element){return null;}_340=cell.column;_343=_340.field;_341=cell.element.contents||cell.element;if((cmp=_340.editorInstance)){if(_30e!=_341&&(!_340.canEdit||_340.canEdit(cell.row.data,_344))){_30e=_341;row=cell.row;_342=this.dirty&&this.dirty[row.id];_344=(_342&&_343 in _342)?_342[_343]:_340.get?_340.get(row.data):row.data[_343];_33b(_340.editorInstance,_340,_341,_344);dfd=new _30b();setTimeout(function(){if(cmp.focus){cmp.focus();}if(_340._editorBlurHandle){_340._editorBlurHandle.resume();}dfd.resolve(cmp);},0);return dfd.promise;}}else{if(_340.editor){cmp=_341.widget||_341.input;if(cmp){dfd=new _30b();if(cmp.focus){cmp.focus();}dfd.resolve(cmp);return dfd.promise;}}}return null;};return function(_345,_346,_347){var _348=_345.renderCell||Grid.defaultRenderCell,_349=[],_34a;if(!_345){_345={};}_345.editor=_346=_346||_345.editor||"text";_345.editOn=_347=_347||_345.editOn;_34a=typeof _346!="string";if(_345.widgetArgs){_309.deprecated("column.widgetArgs","use column.editorArgs instead","dgrid 0.4");_345.editorArgs=_345.widgetArgs;}_30c.after(_345,"init",_347?function(){var grid=_345.grid;if(!grid.edit){grid.edit=edit;}_345.editorInstance=_32f(_345,_348);}:function(){var grid=_345.grid;if(!grid.edit){grid.edit=edit;}if(_34a){_349.push(_30c.before(grid,"removeRow",function(_34b){var _34c=grid.cell(_34b,_345.id).element,_34d=_34c&&(_34c.contents||_34c).widget;if(_34d){_34d.destroyRecursive();}}));}});_30c.after(_345,"destroy",function(){_30a.forEach(_349,function(l){l.remove();});if(_345._editorBlurHandle){_345._editorBlurHandle.remove();}if(_347&&_34a){_345.editorInstance.destroyRecursive();}});_345.renderCell=_347?function(_34e,_34f,cell,_350){if(!_350||!_350.alreadyHooked){on(cell.tagName=="TD"?cell:cell.parentNode,_347,function(){_310=_350;_345.grid.edit(this);});}return _348.call(_345,_34e,_34f,cell,_350);}:function(_351,_352,cell,_353){if(!_345.canEdit||_345.canEdit(_351,_352)){var cmp=_327(_345);_33b(cmp,_345,cell,_352);cell[_34a?"widget":"input"]=cmp;}else{return _348.call(_345,_351,_352,cell,_353);}};return _345;};});},"epi/shell/dgrid/_EditorMetadataMixin":function(){define("epi/shell/dgrid/_EditorMetadataMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dgrid/editor","epi/string","./_MetadataMixin"],function(_354,_355,lang,_356,all,_357,_358,_359){return _355([_359],{editableProperties:null,_editorWidgetsReady:null,editorSettings:{editOn:"click",autoSave:"true"},editorArgs:null,editorType:null,postMixInProperties:function(){this.inherited(arguments);this.metadata.gridEditable=this.metadata.gridEditable||[];this.editorType=this.editorType||_357;this._editorWidgetPromises=[];},_metadataPropertiesToColumnsDefinition:function(_35a,_35b){var _35c=this.inherited(arguments),_35d=this._filterProperties(_35a,this.metadata.gridEditable),_35e=[];for(var i=0,j=_35d.length;i<j;i+=1){var _35f=_35d[i].uiType;if(_35f){_35e.push(_358.slashName(_35f));}}this._editorWidgetsReady=new _356();require(_35e,lang.hitch(this,function(){for(var i=0,j=_35d.length;i<j;i+=1){var prop=_35d[i],_360=arguments[_354.indexOf(_35e,prop.uiType)],_361=_358.pascalToCamel(prop.name),_362=prop.selections&&prop.selections.length>0?{selections:prop.selections}:{};_35c[_361]=this.editorType(lang.mixin(_35c[_361],this.editorSettings,{editor:_360,editorArgs:lang.mixin(_35c[_361].editorArgs,this.editorArgs,prop.settings,_362)}));}this._editorWidgetsReady.resolve();}));return _35c;},startup:function(){var _363=this.getInherited(arguments),args=arguments;return this._editorWidgetsReady.then(lang.hitch(this,function(){this.set("columns",this.columns);return _363.apply(this,args);}));}});});},"epi/shell/dgrid/_MetadataMixin":function(){define("epi/shell/dgrid/_MetadataMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/string"],function(_364,_365,lang,_366){return _365([],{metadata:null,postMixInProperties:function(){this.inherited(arguments);this.metadata=this.metadata||{};this.metadata.gridIncluded=this.metadata.gridIncluded||[];this.metadata.placeColumns=this.metadata.placeColumns||"prepending";this.columns=this.columns&&this.columns instanceof Array?this._columnsArrayToObject(this.columns):this.columns||{};},postCreate:function(){this.inherited(arguments);if(this.metadata.placeColumns==="appending"){lang.mixin(this.columns,this._metadataPropertiesToColumnsDefinition(this.metadata.properties,this.metadata.gridIncluded));}else{this.columns=lang.mixin(this._metadataPropertiesToColumnsDefinition(this.metadata.properties,this.metadata.gridIncluded),this.columns);}},_columnsArrayToObject:function(_367){var _368={};for(var i=0,j=_367.length;i<j;i+=1){_368[_367[i].field]=_367[i];}return _368;},_metadataPropertiesToColumnsDefinition:function(_369,_36a){var _36b={},_36c=this._filterProperties(_369,_36a);for(var i=0,j=_36c.length;i<j;i+=1){var _36d=this.getColumnDefinition(_36c[i]);_36b[_36d.field]=_36d;}return _36b;},_filterProperties:function(_36e,_36f){if(_36f.length>0){return _364.filter(_36e,function(_370){return _364.indexOf(_36f,_370.name)>-1;});}return [];},getColumnDefinition:function(_371){return {label:_371.displayName,field:_366.pascalToCamel(_371.name),sortable:false};}});});},"epi-ecf-ui/contentediting/viewmodel/AssociationCollectionEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./_BaseEntryCollectionEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.associationcollectioneditor"],function(_372,lang,when,_373,res){return _372([_373],{storeKey:"epi.commerce.association",resources:res,saveItem:function(_374){var _375=when(this.store.get(_374.id),lang.hitch(this,function(_376){if(_376.groupName==_374.groupName&&_376.type==_374.type){return this.store.put(_374);}else{var _377=lang.clone(_374);delete _377.id;return when(this.store.remove(_376.id),lang.hitch(this,function(){return this.store.add(_377);}));}}));when(_375,lang.hitch(this,function(data){this.emit("itemSaved",{id:data.id});}));return _375;}});});},"epi-ecf-ui/contentediting/viewmodel/_BaseEntryCollectionEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/promise/all","dojo/Stateful","dojo/when","epi/dependency","epi/shell/command/DelegateCommand","epi/i18n!epi/nls/episerver.shared"],function(_378,lang,_379,all,_37a,when,_37b,_37c,_37d){return _378([_37a,_379],{storeKey:null,resources:null,postscript:function(){this.inherited(arguments);this.storeRegistry=_37b.resolve("epi.storeregistry");this.store=this.store||this.storeRegistry.get(this.storeKey);this.metadataManager=this.metadataManager||_37b.resolve("epi.shell.MetadataManager");},getCommands:function(_37e,_37f){var _380={category:_37f,model:_37e,canExecute:true,isAvailable:true};return [new _37c(lang.mixin({name:"remove",label:this.resources.commands.remove,iconClass:"epi-iconClose",delegate:lang.hitch(this,function(cmd){this.emit("removeCommandEvent");})},_380))];},addItem:function(item){return when(this.store.add(item),lang.hitch(this,function(data){this.emit("itemAdded",{id:data.id});}));},removeItems:function(_381){var _382=[];for(var i=0,j=_381.length;i<j;i+=1){_382.push(this.store.remove(_381[i].id));}return all(_382).then(lang.hitch(this,function(_383){this.emit("itemsRemoved");}));},getListCommand:function(_384){return new _37c({name:"add",label:this.resources.addlabel,tooltip:_37d.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:true,delegate:lang.hitch(this,this.addItemDelegate)});},addItemDelegate:function(){this.emit("toggleItemEditor",null);},moveItem:function(item,_385,_386){this._setSortOrder(item,_385,_386);return when(this.store.put(item),lang.hitch(this,function(data){this.emit("itemSaved",{id:data.id});}));},_setSortOrder:function(item,_387,_388){if(_387){item.sortOrder=_388?_387.sortOrder:_387.sortOrder+1;}}});});},"epi-ecf-ui/store/CompositeKey":function(){define(["dojo/_base/lang","dojo/when"],function(lang,when){var _389=function(_38a,keys,_38b){return lang.delegate(_38a,{keys:keys,getClones:_38b,removeReAdd:function(_38c,_38d){var _38e=lang.clone(_38c),_38f=this.remove(_38c[this.idProperty]);delete _38e[this.idProperty];return when(_38f,function(){return _38a.add(_38e,_38d);});},put:function(_390,_391){var _392=this.get(_390[this.idProperty]);if(_392&&this.keys){for(var i=0,j=this.keys.length;i<j;i+=1){if(_392[keys[i]]!==_390[keys[i]]){return this.removeReAdd(_390,_391);}}}return _38a.put.apply(_38a,arguments);},get:function(id){return _38b?lang.clone(_38a.get.apply(_38a,arguments)):_38a.get.apply(_38a,arguments);}});};return _389;});},"epi-ecf-ui/contentediting/editors/_CollectionEditorDndMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-class","dojo/aspect","epi-cms/dgrid/DnD"],function(_393,_394,lang,_395,_396,_397,DnD){return _394([],{_dndNodeCreator:function(item,hint){var _398=this.allowedDndTypes,node=_395.create("div");return {"node":node,"type":_398,"data":item};},_setupDnD:function(){this.own(_397.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_399,_39a,copy){var _39b=this.grid.dndSource,_39c=_39b.accept&&_39b.checkAcceptance(_399,_39a);_396[_39c?"add":"remove"](this.overlayDnd,this.gridOverlayClass);}),true),_397.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_39d,_39e,_39f,copy){var i;if(this.grid.dndSource===_39e){for(i=0;i<_39f.length;i++){this.model.moveItem(this.grid.dndSource.getItem(_39f[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_39d.length;i++){this._addItem(_39d[i]);if(_39e&&_39e.grid&&_39e.grid.consumer&&_39e.grid.consumer!==this){_39e.grid.consumer.model.removeItem(this.grid.dndSource.getItem(_39f[i].id).data);}}}}});});},"epi-ecf-ui/widget/_RelationViewBase":function(){define(["dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/Evented","dojo/topic","dojo/dom-geometry","dojo/dom-style","dojo/_base/window","dijit/layout/_LayoutWidget","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","./BackToPreviousViewNotification"],function(_3a0,_3a1,lang,_3a2,_3a3,_3a4,_3a5,_3a6,_3a7,_3a8,_3a9,_3aa,_3ab){return _3a1([_3a8],{contentPane:null,_backToPreviousViewNotification:null,postCreate:function(){this.inherited(arguments);this._backToPreviousViewNotification=new _3ab();this.own(this._backToPreviousViewNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)));},_defaultNotificationWatchHandler:function(name,_3ac,_3ad){if(_3ac){this.notificationBar.remove(_3ac);}if(_3ad&&_3ad.content){this.notificationBar.add(_3ad);}},updateView:function(data,_3ae){this.toolbar.update({currentContext:_3ae,viewConfigurations:{availableViews:data.availableViews,viewName:data.viewName}});this._backToPreviousViewNotification.showNotification();},resize:function(){this.inherited(arguments);var top=_3a5.position(this.contentPane.domNode).y;var _3af=_3a5.position(_3a7.body()).h;_3a6.set(this.contentPane.domNode,"height",(_3af-top)+"px");}});});},"epi-ecf-ui/widget/BackToPreviousViewNotification":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/Stateful","dojo/topic","epi-cms/command/BackCommand","epi/i18n!epi/cms/nls/commerce.widget.backtodefaultview"],function(_3b0,_3b1,_3b2,_3b3,_3b4,_3b5){return _3b0([_3b2],{_command:null,notification:null,constructor:function(){this._command=new _3b4({canExecute:true,_execute:function(){_3b3.publish("/epi/shell/action/changeview/back",true);},_onModelChange:function(){}});},showNotification:function(){var _3b6=_3b1.create("div",{innerHTML:_3b5.notificationtext});this.set("notification",{content:_3b6,commands:[this._command]});}});});},"url:epi-ecf-ui/widget/templates/LinkEdit.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top'\"></div>\r\n    <div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"contentPane\" class=\"epi-linkEdit\">\r\n        <div data-dojo-type=\"epi-ecf-ui/contentediting/editors/CategoryCollectionEditor\" data-dojo-attach-point=\"categoryList\"></div>\r\n        <div data-dojo-attach-point=\"associationListNode\"></div>\r\n    </div>\r\n</div>","epi-ecf-ui/widget/VariantEdit":function(){define(["dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/dnd/Target","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/contentediting/editors/_TextWithActionLinksMixin","../contentediting/editors/VariantCollectionEditor","./_RelationViewBase","dojo/text!./templates/VariantEdit.html","epi/i18n!epi/cms/nls/commerce.contentediting.editors.variantcollectioneditor","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/StandardToolbar"],function(_3b7,_3b8,lang,_3b9,_3ba,_3bb,_3bc,_3bd,_3be,_3bf,_3c0,_3c1,_3c2,_3c3,_3c4){return _3b8([_3c2,_3ba,_3bb,_3bc,_3c0],{templateString:_3c3,_dndTarget:null,resources:_3c4,contentPane:this.contentPane,postCreate:function(){this.inherited(arguments);this.setupActionLinks(this.dropContainer);},buildRendering:function(){this.inherited(arguments);this._dndTarget=new _3bd(this.dropContainer,{accept:this.collectionList.allowedDndTypes,insertNodes:function(){}});this.own(_3b7.after(this._dndTarget,"onDropData",lang.hitch(this,function(_3c5){this.collectionList._addItem(_3c5[0],true);}),true));},updateView:function(data,_3c6){this.inherited(arguments);this.set("value",_3c6.id);},getTemplateString:function(){return {templateString:this.resources.drophere,actions:this.resources.actions};},executeAction:function(_3c7){_3b9.publish("/epi/layout/pinnable/tools/toggle",true);},_setValueAttr:function(_3c8){this.collectionList.set("value",_3c8);}});});},"epi-ecf-ui/contentediting/editors/VariantCollectionEditor":function(){define(["dojo/_base/declare","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/editors/model/CollectionEditorModel","./_RelationCollectionEditorBase","../viewmodel/VariantCollectionEditorModel","../ModelSupport","epi/i18n!epi/cms/nls/commerce.contentediting.editors.variantcollectioneditor"],function(_3c9,_3ca,_3cb,_3cc,_3cd,_3ce,_3cf){return _3c9([_3cc,_3ca],{modelType:_3cd,allowedDndTypes:[_3ce.contentTypeIdentifier.variationContent,_3ce.contentTypeIdentifier.productContent,_3ce.linkTypeIdentifier.relation],itemEditorTypes:[_3ce.contentTypeIdentifier.variationContent,_3ce.contentTypeIdentifier.productContent],resources:_3cf,relationType:_3ce.relationType.productVariation});});},"epi-ecf-ui/contentediting/viewmodel/VariantCollectionEditorModel":function(){define(["dojo/_base/declare","./VariantCollectionReadOnlyEditorModel","./_RelationCollectionEditorModelMixin","epi/i18n!epi/cms/nls/commerce.contentediting.editors.variantcollectioneditor"],function(_3d0,_3d1,_3d2,res){return _3d0([_3d1,_3d2],{res:res});});},"url:epi-ecf-ui/widget/templates/VariantEdit.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top'\"></div>\r\n    \r\n    <div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"contentPane\" class=\"epi-linkEdit\">\r\n        <h1>${resources.title}</h1>\r\n        <div data-dojo-attach-point=\"collectionList\" data-dojo-type=\"epi-ecf-ui/contentediting/editors/VariantCollectionEditor\"></div>\r\n        <div data-dojo-attach-point=\"dropContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n    </div>\r\n</div>","epi-ecf-ui/widget/BundleEdit":function(){define(["dojo/_base/declare","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","./_RelationViewBase","dojo/text!./templates/BundleEdit.html","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/StandardToolbar","../contentediting/editors/BundleEntryCollectionEditor"],function(_3d3,_3d4,_3d5,_3d6,_3d7,_3d8,_3d9,_3da,_3db){return _3d3([_3da,_3d4,_3d5,_3d6],{templateString:_3db,contentPane:this.contentPane,updateView:function(data,_3dc){this.inherited(arguments);this.set("value",_3dc.id);},_setValueAttr:function(_3dd){this.collectionList.set("value",_3dd);}});});},"url:epi-ecf-ui/widget/templates/BundleEdit.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top'\"></div>\r\n    <div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"contentPane\" class=\"epi-bundleEdit\">\r\n        <div data-dojo-attach-point=\"collectionList\" data-dojo-type=\"epi-ecf-ui/contentediting/editors/BundleEntryCollectionEditor\"></div>\r\n    </div>\r\n</div>","epi-ecf-ui/contentediting/editors/BundleEntryCollectionEditor":function(){define(["dojo/_base/declare","dojo/topic","../ModelSupport","../viewmodel/EntryRelationCollectionEditorModel","./LinkEditEditor","./_BundleEntryCollectionEditorGrid","./_GroupDefinitionEditorMixin","epi/i18n!epi/cms/nls/commerce.contentediting.editors.bundleentrycollectioneditor"],function(_3de,_3df,_3e0,_3e1,_3e2,_3e3,_3e4,_3e5){var _3e6=_3de([_3e3],{modelType:_3e1,relationType:_3e0.relationType.bundleEntry,deleteConfirmationTitle:_3e5.deleteconfirmation.title,deleteConfirmationDescription:_3e5.deleteconfirmation.description});return _3de([_3e2,_3e4],{resources:_3e5,gridCollectionType:_3e6,executeAction:function(_3e7){_3df.publish("/epi/layout/pinnable/tools/toggle",true);}});});},"epi-ecf-ui/contentediting/viewmodel/EntryRelationCollectionEditorModel":function(){define(["dojo/_base/declare","./_BaseEntryCollectionEditorModel","epi/i18n!epi/cms/nls/commerce.contentediting.editors.relationcollectioneditor"],function(_3e8,_3e9,res){return _3e8([_3e9],{storeKey:"epi.commerce.relation",resources:res});});},"epi-ecf-ui/contentediting/editors/_BundleEntryCollectionEditorGrid":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/aspect","dojo/Deferred","dojo/when","dojo/Stateful","dijit/_Widget","dijit/_TemplatedMixin","dgrid/editor","dgrid/Selection","dijit/form/Button","dgrid/OnDemandGrid","epi/dependency","epi/string","epi/shell/_ContextMixin","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/dialog/Dialog","epi/shell/dgrid/_EditorMetadataMixin","epi-cms/dgrid/DnD","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Confirmation","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/editors/_AddItemDialogMixin","epi-cms/core/ContentReference","epi-cms/dgrid/WithContextMenu","epi-cms/dgrid/formatters","../ModelSupport","./_CollectionEditorDndMixin","../../dgrid/_ClickablePathColumnMixin","epi/i18n!epi/cms/nls/commerce.contentediting.editors.relationcollectioneditor"],function(_3ea,_3eb,lang,_3ec,_3ed,_3ee,when,_3ef,_3f0,_3f1,_3f2,_3f3,_3f4,Grid,_3f5,_3f6,_3f7,_3f8,_3f9,_3fa,DnD,_3fb,_3fc,_3fd,_3fe,_3ff,_400,_401,_402,_403,_404,_405,_406){return _3eb([_3f0,_3f1,_3fc,_3ff,_3fb,_404,_3f7],{templateString:"<div>                            <div data-dojo-attach-point=\"commandTargetNode\"></div>                            <div data-dojo-attach-point=\"overlayDnd\">                                <div class=\"epi-relationCollectionEditor\" data-dojo-attach-point=\"gridNode\"></div>                            </div>                        </div>",grid:null,storeKey:"epi.commerce.relation",gridOverlayClass:"epi-grid-dnd-overlay",itemType:"EPiServer.Commerce.AddOns.UI.Rest.Models.RelationModel",allowedDndTypes:[_403.contentTypeIdentifier.variationContent,_403.contentTypeIdentifier.productContent,_403.linkTypeIdentifier.relation],includedColumns:["ContentTypeIdentifier","Name","Path","Quantity","GroupName"],editableColumns:["Quantity","GroupName"],cellActionName:"epiGridAction",itemEditorType:_3fe,noDataMessage:_406.nodatamessage,addLabelText:_406.addlabel,postMixInProperties:function(){this.model=this.model||new this.modelType({itemType:this.itemType});},postCreate:function(){this.inherited(arguments);if(!this.roots){var _407=_3f5.resolve("epi.cms.contentRepositoryDescriptors"),_408=_407.catalog;this.roots=_408.roots;}var _409=new _3f8({settings:{showLabel:true}}),_40a=this.model.getListCommand();_409.create(_40a,this.gridNode);var _40b=_3eb([Grid,_3f3,_3f2,_3fa,_401,DnD,_405],{});when(this.model.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_40c){var _40d=[{field:"contentTypeIdentifier",renderHeaderCell:function(){},get:function(_40e){return _40e.contentTypeIdentifier;},label:"",formatter:_402.contentIcon,className:"epi-columnIcon16x16",sortable:false},{field:this.cellActionName,renderHeaderCell:function(){},renderCell:lang.hitch(this,function(_40f,_410,node,_411){var _412=new _3f8({settings:{showLabel:false}}),_413=this.model.getCommands(this.grid,null);_3ea.forEach(_413,function(_414){_412.create(_414,node);});}),className:"epi-columnNarrow",sortable:false}],_415=_3f5.resolve("epi.storeregistry").get(this.storeKey),grid=this.grid=new _40b({store:_415,minWidth:100,noDataMessage:this.noDataMessage,selectionMode:"single","class":"epi-plain-grid epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders",columns:_40d,metadata:{properties:_40c.properties,gridIncluded:this.includedColumns,gridEditable:this.editableColumns},dndSourceTypes:[_403.linkTypeIdentifier.relation],dndParams:{copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)}});_3ec.place(this.grid.domNode,this.gridNode);this.own(grid,this.model.on("itemAdded",lang.hitch(this,function(e){this.grid.refresh();})),this.model.on("itemRemoved",lang.hitch(this,function(e){this.grid.refresh();})),this.model.on("itemSaved",lang.hitch(this,function(){this.grid.refresh();})),this.model.watch("contentLink",lang.hitch(this,function(_416,_417,_418){this._updateGridQuery(_418);grid.resize();})),this.model.on("removeCommandEvent",lang.hitch(this,function(){when(this._showConfirmation(this.deleteConfirmationTitle,this.deleteConfirmationDescription),lang.hitch(this,function(){if(this.model){var _419=[];for(var _41a in this.grid.selection){if(this.grid.selection.hasOwnProperty(_41a)){_419.push(this.model.store.get(_41a));}}return this.model.removeItems(_419);}}));})));this._setupDnD();when(this.getCurrentContext(),lang.hitch(this,function(_41b){this._updateGridQuery(_41b.id);this.grid.startup();}));}));},_updateGridQuery:function(_41c){var _41d=this.getQueryOptions(_41c);this.grid.set("query",_41d.query,_41d.options);},getQueryOptions:function(_41e){return {query:{referenceId:new _400(_41e).createVersionUnspecificReference().toString(),relationTypes:[this.relationType]},options:{ignore:["referenceId","relationTypes"]}};},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_41f){return this.model.addItem(_41f);}));},resize:function(){this.inherited(arguments);if(this.grid){this.grid.resize();}},_getDialogTitleText:function(){return this.addLabelText;},_createItemEditor:function(){return new this.itemEditorType({canSelectOwnerContent:false,showButtons:false,roots:this.roots,allowedTypes:[_403.contentTypeIdentifier.variationContent,_403.contentTypeIdentifier.productContent],showAllLanguages:false});},_dndGetItemData:function(item){return when(item.data,lang.hitch(this,function(data){return this._createItem(data.contentLink,data.name);}));},_createItem:function(_420,name){return {name:name||_420,groupName:"Default",quantity:1,sortOrder:0,source:this.model.get("contentLink"),target:_420,type:this.relationType};},onExecuteDialog:function(){var item=this._itemEditor.get("value");this._addItem({data:{contentLink:item}},true);},_setValueAttr:function(_421){this._set("value",_421);if(this.model){this.model.set("contentLink",_421);}},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},_showConfirmation:function(_422,_423){var _424=new _3ee();var _425=new _3fd({destroyOnHide:true,title:_3f6.toHTML(_422),description:_3f6.toHTML(_423),onAction:function(_426){if(_426){_424.resolve();}else{_424.cancel();}}});_425.show();return _424.promise;}});});},"epi-ecf-ui/contentediting/editors/_GroupDefinitionEditorMixin":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/form/Button","epi/shell/widget/dialog/Dialog","./RelationGroupDefinitionEditor","epi/i18n!epi/cms/nls/commerce.contentediting.editors.relationgroupeditor","epi/i18n!epi/nls/episerver.shared"],function(_427,_428,_429,_42a,_42b,_42c,_42d){return _427([],{buildRendering:function(){this.inherited(arguments);var _42e=new _429({"class":"epi-trailingButton",label:_42c.editbuttontext,title:_42c.editbuttontext});_428.place(_42e.domNode,this.collectionList,"before");this.own(_42e.on("click",function(){var _42f=new _42b();var _430=new _42a({defaultActionsVisible:false,content:_42f,title:_42c.title,destroyOnHide:true,closeIconVisible:false,getActions:function(){var done={name:"done",label:_42d.action.done,title:null,settings:{type:"submit","class":"Salt"}};return [done];}});_430.show();}));}});});},"epi-ecf-ui/contentediting/editors/RelationGroupDefinitionEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dgrid/OnDemandGrid","dgrid/Selection","epi/dependency","epi/shell/command/_Command","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/dialog/_DialogContentMixin","./AddRelationGroupDefinitionCommand","epi/i18n!epi/cms/nls/commerce.contentediting.editors.relationgroupeditor"],function(_431,lang,_432,_433,_434,_435,_436,_437,Grid,_438,_439,_43a,_43b,_43c,_43d,_43e){return _431([_436,_437,_43c],{templateString:"<div><div data-dojo-attach-point=\"addNode\"></div></div>",store:null,grid:null,addButton:null,_builder:null,constructor:function(){this.store=this.store||_439.resolve("epi.storeregistry").get("epi.commerce.relationgroupdefinition");this._builder=new _43b({settings:{showLabel:false}});},postCreate:function(){this.inherited(arguments);this.addButton=new _43d();this._builder.create(this.addButton,this.addNode);this._setupGrid();this.own(_432.after(this.addButton,"onSaved",lang.hitch(this,function(){this.grid.refresh();})));},_setupGrid:function(){var _43f=_431([Grid,_438]);this.grid=new _43f({columns:{name:_43e.groupname,action:{className:"epi-columnNarrow",renderHeaderCell:function(node){},renderCell:lang.hitch(this,function(_440,_441,node,_442){var _443=new _43a({iconClass:"epi-iconClose",canExecute:true,_execute:lang.hitch(this,function(){this.store.remove(_440.name).then(lang.hitch(this,function(){this.grid.refresh();}));})});this._builder.create(_443,node);})}},store:this.store,className:"epi-plain-grid"});this.grid.set("query",{});this.own(this.grid);_433.place(this.grid.domNode,this.domNode);},layout:function(){this.inherited(arguments);var _444=this.getParent();if(_444&&_444.containerNode){var _445=_434.get(_444.containerNode,"height"),_446=Math.max(_435.getMarginBox(this.grid.headerNode).h,_434.get(this.grid.bodyNode,"margin")),_447=_435.getMarginBox(this.addNode).h;_434.set(this.domNode,"height",_445+"px");_434.set(this.grid.contentNode,"height",(_445-_447-_446)+"px");}}});});},"epi-ecf-ui/contentediting/editors/AddRelationGroupDefinitionCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi/dependency","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/nls/episerver.shared","epi/i18n!epi/cms/nls/commerce.command.addgroup","dojo/text!./templates/ManageGroupDefinitionDialog.html"],function(_448,lang,when,_449,_44a,_44b,_44c,_44d,_44e,_44f,_450,_451,_452){var _453=_448([_449,_44a,_44b],{templateString:_452,store:null,resources:_450.header,constructor:function(){this.store=this.store||_44d.resolve("epi.storeregistry").get("epi.commerce.relationgroupdefinition");},saveToStore:function(){if(this.nameTextBox.validate()){return this.store.put({name:this.nameTextBox.value});}}});return _448([_44e,_44f],{dialogContentClass:_453,dialogClass:"epi-dialog-confirm",dialogParams:{autofocus:true},iconClass:"epi-iconPlus",confirmActionText:_450.action.add,title:_451.title,postscript:function(){this.inherited(arguments);if(!this.dialogParams){this.dialogParams={};}this.dialogParams.closeIconVisible=false;},_execute:function(){this.showDialog();if(this._dialog){this._setDialogConfirmActionStatus();this.dialogContent.nameTextBox.on("change",lang.hitch(this,this._setDialogConfirmActionStatus));}},_setDialogConfirmActionStatus:function(){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!this.dialogContent.nameTextBox.validate());},onDialogExecute:function(){when(this.dialogContent.saveToStore(),lang.hitch(this,this.onSaved));},onSaved:function(){},canExecute:true});});},"url:epi-ecf-ui/contentediting/editors/templates/ManageGroupDefinitionDialog.html":"<div>\r\n    <label for=\"name\">${resources.name} </label>\r\n    <div data-dojo-type=\"dijit/form/ValidationTextBox\" data-dojo-attach-point=\"nameTextBox\" name=\"name\" required=\"true\" data-dojo-props=\"intermediateChanges:true, regExp:'^[A-Za-z0-9]([A-Za-z0-9 _\\-])*$'\"></div>\r\n</div>","epi-ecf-ui/widget/PackageEdit":function(){define(["dojo/_base/declare","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","./_RelationViewBase","dojo/text!./templates/PackageEdit.html","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/StandardToolbar","../contentediting/editors/PackageEntryCollectionEditor"],function(_454,_455,_456,_457,_458,_459,_45a,_45b,_45c){return _454([_45b,_455,_456,_457],{templateString:_45c,contentPane:this.contentPane,updateView:function(data,_45d){this.inherited(arguments);this.set("value",_45d.id);},_setValueAttr:function(_45e){this.collectionList.set("value",_45e);}});});},"url:epi-ecf-ui/widget/templates/PackageEdit.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top'\"></div>\r\n    <div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"contentPane\" class=\"epi-packageEdit\">\r\n        <div data-dojo-attach-point=\"collectionList\" data-dojo-type=\"epi-ecf-ui/contentediting/editors/PackageEntryCollectionEditor\"></div>\r\n    </div>\r\n</div>","epi-ecf-ui/contentediting/editors/PackageEntryCollectionEditor":function(){define(["dojo/_base/declare","dojo/topic","../ModelSupport","../viewmodel/EntryRelationCollectionEditorModel","./LinkEditEditor","./_BundleEntryCollectionEditorGrid","./_GroupDefinitionEditorMixin","epi/i18n!epi/cms/nls/commerce.contentediting.editors.packageentrycollectioneditor"],function(_45f,_460,_461,_462,_463,_464,_465,_466){var _467=_45f([_464],{modelType:_462,relationType:_461.relationType.packageEntry,deleteConfirmationTitle:_466.deleteconfirmation.title,deleteConfirmationDescription:_466.deleteconfirmation.description});return _45f([_463,_465],{resources:_466,gridCollectionType:_467,executeAction:function(_468){_460.publish("/epi/layout/pinnable/tools/toggle",true);}});});},"epi-ecf-ui/component/Catalogs":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/topic","epi-cms/widget/HierarchicalList","./CatalogsViewModel","epi/i18n!epi/cms/nls/commerce.components.catalogs"],function(_469,lang,on,_46a,_46b,_46c,res){return _469([_46b],{res:res,triggerContextChange:true,modelClassName:_46c,startup:function(){this.inherited(arguments);_46a.subscribe("relationChanged",lang.hitch(this,function(){this.list._updateQuery(this.list.query);}));this.tree.dndController.readOnly=true;},postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocatalogentry);},setupContextMenu:function(){}});});},"epi-ecf-ui/component/CatalogsViewModel":function(){define(["dojo/_base/declare","epi-cms/widget/viewmodel/HierarchicalListViewModel","../widget/viewmodel/CatalogTreeStoreModel"],function(_46d,_46e,_46f){return _46d([_46e],{treeStoreModelClass:_46f,postscript:function(){this.isAvailableFlags=this.isAvailableFlags||this.menuType.ROOT|this.menuType.TREE|this.menuType.LIST;this.inherited(arguments);this.set("commands",[]);},_getSortSettings:function(){return [];},contentContextChanged:function(_470,_471){var _472=this.get("currentListItem");if(_472){return;}this.inherited(arguments);}});});},"epi-ecf-ui/component/PricingOverview":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/PricingOverview.html","epi/i18n!epi/cms/nls/commerce.components.pricingoverview","epi-cms/contentediting/StandardToolbar","../widget/PricingOverview"],function(_473,_474,_475,_476,_477,_478,_479){return _473([_475,_476,_477],{resources:_479,templateString:_478,updateView:function(data,_47a){this.toolbar.update({currentContext:_47a,viewConfigurations:{availableViews:data.availableViews,viewName:data.viewName}});this.set("value",_47a);this.pricingOverview.showNotification();},_setValueAttr:function(_47b){this.pricingOverview.set("value",_47b);},layout:function(){var _47c=_474.getMarginBox(this.toolbar.domNode);this.pricingOverview.resize({h:this._contentBox.h-_47c.h,w:this._contentBox.w});}});});},"url:epi-ecf-ui/component/templates/PricingOverview.html":"<div>\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div data-dojo-type='epi-ecf-ui/widget/PricingOverview' data-dojo-attach-point='pricingOverview'></div>\r\n</div>","epi-ecf-ui/widget/PricingOverview":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/html/entities","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/contentediting/NotificationBar","../contentediting/editors/PricingOverviewEditor","../contentediting/ModelSupport","./BackToPreviousViewNotification","./MarketSelector","./viewmodel/PricingOverviewModel","epi/i18n!epi/cms/nls/commerce.widget.pricingoverview","epi/i18n!epi/cms/nls/commerce.widget.market","epi/i18n!epi/cms/nls/commerce.widget.customergroup","dojo/text!./templates/PricingOverview.html"],function(_47d,lang,_47e,when,dom,_47f,_480,_481,_482,_483,_484,_485,_486,_487,_488,_489,_48a,_48b,_48c,_48d,_48e,_48f,_490,_491,_492){return _47d([_482,_483,_484,_487],{resources:_48f,templateString:_492,modelClassName:_48e,defaultCGItem:{id:"ALL",name:_491.defaultitem},_backToPreviousViewNotification:null,modelBindingMap:{"markets":["markets"],"customerGroups":["customerGroups"]},postCreate:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _493=_47d(this.modelClassName);this.set("model",new _493());}this.model.populateData();this._backToPreviousViewNotification=new _48c();this.own(this._backToPreviousViewNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)));},buildRendering:function(){this.inherited(arguments);this.priceList=new _48a();this.own(this.priceList);_47f.place(this.priceList.domNode,this.priceListNode);},showNotification:function(){this._backToPreviousViewNotification.showNotification();},_defaultNotificationWatchHandler:function(name,_494,_495){if(_494){this.notificationBar.remove(_494);}if(_495&&_495.content){this.notificationBar.add(_495);}this.layout();},layout:function(){var _496=_480.position(dojo.query(".epi-pricingOverview .epi-filterHolder .epi-filterHolderLeading")[0]);var _497=_480.position(dojo.query(".epi-pricingOverview .epi-filterHolder")[0]);var _498=_480.position(dojo.query(".epi-pricingOverview .epi-filterHolder .epi-filterHolderCenter.clearfix")[0]);var _499=(_497.w-_496.w-_498.w)/2+"px";_481.set(dojo.query(".epi-pricingOverview .epi-filterHolder .epi-filterHolderCenter.clearfix")[0],"marginLeft",_499);var _49a=_480.getMarginBox(this.header);_480.setMarginBox(this.priceListNode,{h:this._contentBox.h-_49a.h,w:this._contentBox.w});},_setCustomerGroupsAttr:function(_49b){this.customerGroupSelector._onChangeActive=false;this.customerGroupSelector.removeOption(this.customerGroupSelector.options);if(_49b){_49b.unshift(this.defaultCGItem);_47e.forEach(_49b,function(_49c){this.customerGroupSelector.addOption({label:_486.encode(_49c.name),value:_49c.id});},this);}this.customerGroupSelector._onChangeActive=true;},_onMarketChanged:function(){var val=this.marketSelector.value;if(this.priceList.grid){if(val==="ALL"){this.priceList.grid.styleColumn("marketId","display: table-cell;");}else{this.priceList.grid.styleColumn("marketId","display: none;");}}this.priceList.set("marketId",val);},_onAddNewPrice:function(){var _49d=this.marketSelector.value;if(_49d==="ALL"){_49d=null;}var _49e=this.customerGroupSelector.value;if(_49e==="ALL"){_49e=null;}var _49f=this.model.getDefaultPrice(_49d,_49e);this.priceList.addPrice(_49f);},_onCustomerGroupChanged:function(){var val=this.customerGroupSelector.value;if(val==="ALL"){this.priceList.grid.styleColumn("priceCode","display: table-cell;");this.priceList.grid.styleColumn("priceType","display: table-cell;");}else{this.priceList.grid.styleColumn("priceCode","display: none;");this.priceList.grid.styleColumn("priceType","display: none;");}this.priceList.set("priceCode",val);},_setValueAttr:function(_4a0){this.priceList.set("value",_4a0.id);if(_488.isBaseTypeIdentifier(_4a0.dataType,_48b.contentTypeIdentifier.variationContent)||_488.isBaseTypeIdentifier(_4a0.dataType,_48b.contentTypeIdentifier.packageContent)){_481.set(this.addNewPrice.domNode,"display","");this.model.set("value",_4a0.id);}else{_481.set(this.addNewPrice.domNode,"display","none");}}});});},"epi-ecf-ui/contentediting/editors/PricingOverviewEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/dom-construct","dojo/Stateful","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/editor","epi/dependency","epi/string","epi/shell/_ContextMixin","epi/shell/dgrid/_EditorMetadataMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Confirmation","epi-cms/dgrid/WithContextMenu","epi-cms/dgrid/formatters","../viewmodel/PricingOverviewEditorModel","./SaleCodeEditor","./MoneyEditor","epi/i18n!epi/cms/nls/commerce.widget.pricingoverview.grid","epi/i18n!epi/cms/nls/commerce.widget.pricecollection.message"],function(_4a1,_4a2,lang,_4a3,_4a4,_4a5,when,_4a6,_4a7,_4a8,_4a9,_4aa,_4ab,_4ac,_4ad,_4ae,_4af,_4b0,_4b1,_4b2,_4b3,_4b4,_4b5,_4b6,_4b7,_4b8,_4b9,_4ba,_4bb){return _4a2([_4a6,_4a7,_4b3,_4b2,_4b0],{templateString:"<div class=\"epi-pricingOverviewEditor\" data-dojo-attach-point=\"gridNode\"></div>",grid:null,modelType:_4b7,itemType:"EPiServer.Commerce.AddOns.UI.ObjectEditing.InternalMetadata.PriceModel",includedColumns:["Name","Code","MarketId","PriceType","MinQuantity","PriceCode","UnitPrice","ValidDate"],editableColumns:["MarketId","PriceType","MinQuantity","PriceCode","UnitPrice","ValidDate"],postMixInProperties:function(){this.model=this.model||new this.modelType({itemType:this.itemType});},postCreate:function(){this.inherited(arguments);var _4bc=_4a2([_4aa,_4ab,_4ad,_4b1,_4ac,_4b5],{getColumnDefinition:function(_4bd){var _4be=this.inherited(arguments);if(_4be.field!=="unitPrice"&&_4bd.selections&&_4bd.selections.length>0){_4be.renderCell=this._renderSelectorValue(_4bd.selections);}return _4be;},_renderSelectorValue:function(_4bf){return lang.hitch(this,function(item,_4c0,node,_4c1){_4bf.some(function(_4c2){if(_4c2.value===_4c0){node.innerHTML=typeof _4c2.text==="string"?_4a9.encode(_4c2.text):_4c2.text;return true;}});if(!node.innerHTML){node.innerHTML=typeof _4c0==="string"?_4a9.encode(_4c0):_4c0;}});}});when(this.model.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_4c3){var _4c4=[{field:"epiGridAction",renderHeaderCell:function(){},formatter:function(){return _4b6.menu({title:_4ba.commands.title});},className:"epi-columnNarrow",sortable:false}],_4c5=_4ae.resolve("epi.storeregistry").get("epi.commerce.price"),grid=this.grid=new _4bc({selectionMode:"single",store:_4c5,minWidth:100,noDataMessage:_4ba.nodatamessage,"class":"epi-plain-grid",columns:_4c4,metadata:{properties:_4c3.properties,gridIncluded:this.includedColumns,gridEditable:this.editableColumns}});this.model.generateFormatters(grid.columns);_4a4.place(this.grid.domNode,this.gridNode);this._setupEvents(grid);this._setupContextMenu();when(this.getCurrentContext(),lang.hitch(this,function(_4c6){if(this.model.get("contentLink")!==_4c6.id){this.set("value",_4c6.id);}else{this._updateGridQuery(grid);}grid.startup();}));}));this._setMarkets();},_setupEvents:function(grid){var _4c7=2;this.own(grid,grid.on("dgrid-editor-show",lang.hitch(this,function(e){if(e.editor instanceof _4b8){e.editor.showDropDown(e.cell.row.data.priceType==_4c7);}else{if(e.editor instanceof _4b9){this._setCurrencySelections(e);}}})),grid.on("dgrid-datachange",lang.hitch(this,function(e){if(e.cell.column.field=="priceType"&&(e.value==_4c7||e.oldValue==_4c7)){e.cell.row.data.priceCode="";}if(e.cell.column.field=="unitPrice"&&(isNaN(e.value.amount)||e.value.amount<0)){e.preventDefault();}})),this.model.watch("contentLink",lang.hitch(this,this._changeGridQuery)),this.model.watch("marketId",lang.hitch(this,this._changeGridQuery)),this.model.watch("priceCode",lang.hitch(this,this._changeGridQuery)),this.model.on("itemAdded",lang.hitch(this,function(e){when(this.grid.refresh(),lang.hitch(this,function(){var _4c8=this.grid.row(e.id);if(_4c8){var _4c9=_4c8.element.parentNode;_4c8=this.grid.insertRow(_4c8.data,_4c9,_4c9.firstChild,1,{});this.grid.select(_4c8);_4a8.focus(this.grid.domNode);}}));})),this.model.on("itemsRemoved",lang.hitch(this,function(e){this.grid.refresh();})),this.model.on("removeCommandEvent",lang.hitch(this,function(){when(this._showConfirmation(_4ba.deleteconfirmation.pricetitle,_4ba.deleteconfirmation.pricedescription),lang.hitch(this,function(){if(this.model){var _4ca=[];for(var _4cb in this.grid.selection){if(this.grid.selection.hasOwnProperty(_4cb)){_4ca.push(this.model.store.get(_4cb));}}return this.model.removeItems(_4ca);}}));})),this.model.on("duplicateCommandEvent",lang.hitch(this,function(){var row=this._getSelectedRow(),_4cc=row.data,_4cd=row.element;if(_4cc&&this.model){var _4ce=lang.clone(_4cc);delete _4ce.id;this.model.addItem(_4ce);}})));},_updateGridQuery:function(grid){var _4cf=this.model._createQueryOptions();grid.set("query",_4cf.query,_4cf.options);},_changeGridQuery:function(_4d0,_4d1,_4d2){if(_4d1!==_4d2){this._updateGridQuery(this.grid);}},_setCurrencySelections:function(e){var _4d3=e.cell.row.data.unitPrice.currency;var _4d4=null;_4a1.some(e.editor.get("selections"),function(_4d5){if(_4d5.value==_4d3){_4d4=_4d5;return true;}});var _4d6=this._getMarket(e.cell.row.data.marketId);if(_4d6){var _4d7=_4d6["currencies"].slice(0);if(_4d4){var _4d8=_4a1.some(_4d7,function(_4d9){return _4d9.value==_4d4.value;});if(!_4d8){_4d7.push(_4d4);}}e.editor.set("selections",_4d7);e.editor.set("value",e.cell.row.data.unitPrice);}},_setupContextMenu:function(){this.commands=this.model.getCommands(this.grid,"context");this.grid.contextMenu.addProvider(new _4a5({commands:this.commands}));},_setMarkets:function(){if(!this.get("markets")){var _4da=_4ae.resolve("epi.storeregistry").get("epi.commerce.market");_4da.query().then(lang.hitch(this,function(_4db){this.set("markets",_4db);}));}},_getMarket:function(_4dc){var _4dd=this.get("markets"),_4de=null;_4a1.some(_4dd,function(m){if(m.id==_4dc){_4de=m;return true;}});return _4de;},_getSelectedRow:function(){return this.grid.row(this._getSelectedRowId());},_getSelectedRowId:function(){for(var id in this.grid.selection){return id;}},_noDataMessage:_4ba.nodatamessage,_setValueAttr:function(_4df){this._set("value",_4df);if(this.model){this.model.set("contentLink",_4df);}},_setMarketIdAttr:function(_4e0){this.model.set("marketId",_4e0);},_setPriceCodeAttr:function(_4e1){this.model.set("priceCode",_4e1);},_showConfirmation:function(_4e2,_4e3){var _4e4=new _4a3();var _4e5=new _4b4({destroyOnHide:true,title:_4af.toHTML(_4e2),description:_4af.toHTML(_4e3),onAction:function(_4e6){if(_4e6){_4e4.resolve();}else{_4e4.cancel();}}});_4e5.show();return _4e4.promise;},addPrice:function(_4e7){var _4e8=this.get("markets");if(!_4e7.marketId&&_4e8&&_4e8.length>0){var _4e9=_4e8[0];_4e7=lang.mixin(_4e7,{marketId:_4e9.id,currency:_4e9.currencies[0].value});}return this.model.addItem(_4e7);}});});},"epi-ecf-ui/contentediting/viewmodel/PricingOverviewEditorModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/currency","dojo/when","dojo/Stateful","dojo/Evented","dojo/promise/all","epi/shell/_StatefulGetterSetterMixin","epi/shell/command/DelegateCommand","epi/dependency","epi/datetime","epi/i18n!epi/cms/nls/commerce.widget.pricingoverview.grid","epi/i18n!epi/cms/nls/commerce.widget.pricecollection.message"],function(_4ea,lang,_4eb,when,_4ec,_4ed,all,_4ee,_4ef,_4f0,_4f1,_4f2,res){return _4ea([_4ec,_4ee,_4ed],{_storeKey:"epi.commerce.price",store:null,metadataManager:null,contentLink:null,marketId:null,priceCode:null,queryOptions:null,getChildrenQueryName:"getpricechildren",postscript:function(){this.inherited(arguments);this.storeRegistry=_4f0.resolve("epi.storeregistry");this.store=this.store||this.storeRegistry.get(this._storeKey);this.metadataManager=this.metadataManager||_4f0.resolve("epi.shell.MetadataManager");},_createQueryOptions:function(){var _4f3={referenceId:this.get("contentLink"),query:this.getChildrenQueryName},_4f4=["query","referenceId"];if(this.get("marketId")){lang.mixin(_4f3,{marketId:this.get("marketId")});if(_4f3.marketId==="ALL"){_4f4.push("marketId");}}if(this.get("priceCode")){lang.mixin(_4f3,{priceCode:this.get("priceCode")});if(_4f3.priceCode==="ALL"){_4f4.push("priceCode");}}return {query:_4f3,options:{ignore:_4f4}};},getCommands:function(_4f5,_4f6){var _4f7={category:_4f6,model:_4f5,canExecute:true,isAvailable:true};return [new _4ef(lang.mixin({name:"duplicate",label:_4f2.commands.duplicate,iconClass:"epi-iconDuplicatePage",delegate:lang.hitch(this,function(cmd){this.emit("duplicateCommandEvent");})},_4f7)),new _4ef(lang.mixin({name:"remove",label:_4f2.commands.remove,iconClass:"epi-iconClose",delegate:lang.hitch(this,function(cmd){this.emit("removeCommandEvent");})},_4f7))];},addItem:function(item){return when(this.store.add(item),lang.hitch(this,function(data){this.emit("itemAdded",{id:data.id});}));},removeItems:function(_4f8){var _4f9=[];for(var i=0,j=_4f8.length;i<j;i+=1){_4f9.push(this.store.remove(_4f8[i].id));}return all(_4f9).then(lang.hitch(this,function(_4fa){this.emit("itemsRemoved",{removedItems:data});}));},generateFormatters:function(_4fb){_4fb["validDate"].formatter=lang.hitch(this,this._formatValidDate);_4fb["unitPrice"].formatter=function(_4fc){return _4eb.format(_4fc.amount,{currency:_4fc.currency});};},_formatValidDate:function(_4fd){return this._formatDate(_4fd.validFrom)+" - "+this._formatDate(_4fd.validUntil);},_formatDate:function(_4fe){return _4fe&&_4fe!==""?_4f1.toUserFriendlyString(_4fe):res.untildatenotdefined;}});});},"epi-ecf-ui/contentediting/editors/SaleCodeEditor":function(){define(["dojo/_base/declare","dojo/dom-style","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","dijit/focus","epi-cms/contentediting/editors/SelectionEditor","dojo/text!./templates/SaleCodeEditor.html"],function(_4ff,_500,keys,_501,_502,_503,_504,_505,_506,_507){return _4ff([_501,_502,_503],{templateString:_507,shouldShowDropDown:false,startup:function(){this.showDropDown(this.get("shouldShowDropDown"));},showDropDown:function(_508){this.set("shouldShowDropDown",_508);_500.set(this.selectWidget.domNode,"display",_508?"":"none");_500.set(this.textWidget.domNode,"display",_508?"none":"");},_getValueAttr:function(){return this._getActiveWidget().get("value");},_setValueAttr:function(_509){this.selectWidget.set("value",_509);this.textWidget.set("value",_509);},_getActiveWidget:function(){return this.get("shouldShowDropDown")?this.selectWidget:this.textWidget;},_setSelectionsAttr:function(_50a){this.selectWidget.set("selections",_50a);},_handleKey:function(e){if(e.keyCode==keys.ENTER){e.preventDefault();_505.curNode.blur();}},focus:function(){this._getActiveWidget().focus();}});});},"url:epi-ecf-ui/contentediting/editors/templates/SaleCodeEditor.html":"<div class=\"epi-saleCodeEditor\">\r\n    <div data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"textWidget\" data-dojo-attach-event=\"onKeyDown: _handleKey\"></div>\r\n    <div data-dojo-type=\"epi-cms/contentediting/editors/SelectionEditor\" data-dojo-attach-point=\"selectWidget\" data-dojo-attach-event=\"onKeyDown: _handleKey\"></div>\r\n</div>\r\n","epi-ecf-ui/contentediting/editors/MoneyEditor":function(){define(["dojo/_base/declare","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/NumberTextBox","dijit/focus","epi/epi","epi-cms/contentediting/editors/SelectionEditor","dojo/text!./templates/MoneyEditor.html"],function(_50b,keys,_50c,_50d,_50e,_50f,_510,epi,_511,_512){return _50b([_50c,_50d,_50e],{templateString:_512,value:null,_getValueAttr:function(){var _513=this.value;var _514={currency:this.currency.get("value"),amount:this.amount.get("value")};if(epi.areEqual(_514,_513)){return _513;}else{return _514;}},_setValueAttr:function(_515){this._set("value",_515);this.currency.set("value",_515.currency);this.amount.set("value",_515.amount);},_setSelectionsAttr:function(_516){this.currency.set("selections",_516);},_handleKey:function(e){if(e.keyCode==keys.ENTER){e.preventDefault();_510.curNode.blur();}},focus:function(){this.amount.focus();}});});},"url:epi-ecf-ui/contentediting/editors/templates/MoneyEditor.html":"<div class=\"epi-moneyEditor\">\r\n    <div data-dojo-type=\"epi-cms/contentediting/editors/SelectionEditor\" data-dojo-attach-point=\"currency\" data-dojo-attach-event=\"onKeyDown: _handleKey\"></div>\r\n    <div data-dojo-type=\"dijit/form/NumberTextBox\" data-dojo-attach-point=\"amount\" data-dojo-attach-event=\"onKeyDown: _handleKey\"></div>\r\n</div>","epi-ecf-ui/widget/viewmodel/PricingOverviewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Stateful","epi/dependency","epi/datetime","epi/shell/_StatefulGetterSetterMixin"],function(_517,lang,when,_518,_519,_51a,_51b){return _517([_518,_51b],{_customerGroupStore:null,_contentStructureStore:null,content:null,postscript:function(){this.inherited(arguments);var _51c=_519.resolve("epi.storeregistry");this._customerGroupStore=this._customerGroupStore||_51c.get("epi.commerce.customergroup");this._contentStructureStore=this._contentStructureStore||_51c.get("epi.cms.content.light");},populateData:function(){when(this._customerGroupStore.query(),lang.hitch(this,function(_51d){this.set("customerGroups",_51d);}));},_setValueAttr:function(_51e){this._set("value",_51e);when(this._contentStructureStore.get(_51e),lang.hitch(this,function(_51f){this.set("content",_51f);}));},getDefaultPrice:function(_520,_521){if(!this.content){return null;}var now=new Date();var _522=0;var _523=2;return {contentLink:this.content.contentLink,name:this.content.name,code:this.content.properties.code,marketId:_520,priceType:_521?_523:_522,priceCode:_521||"",unitPrice:null,minQuantity:0,validDate:{validFrom:_51a.serialize(now),validUntil:_51a.serialize(now)}};}});});},"url:epi-ecf-ui/widget/templates/PricingOverview.html":"<div class=\"epi-pricingOverview\">\r\n    <div data-dojo-attach-point=\"header\">\r\n        <div data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-attach-point=\"notificationBar\"></div>\r\n        <div class=\"epi-pricingOverviewEdit\">\r\n            <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n            <div class=\"epi-filterHolder\">\r\n                <div class=\"epi-filterHolderLeading\">\r\n                    <button class=\"epi-mediumButton\"\r\n                            data-dojo-attach-event='onClick: _onAddNewPrice'\r\n                            data-dojo-attach-point=\"addNewPrice\"\r\n                            data-dojo-type=\"dijit/form/Button\"\r\n                            data-dojo-props=\"label: '${resources.buttons.addprice}', title:'${resources.buttons.addprice}', iconClass:'epi-iconPlus'\"></button>\r\n                </div>\r\n                <div class=\"epi-filterHolderCenter clearfix\">\r\n                    <label for=\"customergroup\">${resources.selectors.customergroup}</label>\r\n                    <select name=\"customergroup\"\r\n                            data-dojo-type=\"dijit/form/Select\"\r\n                            data-dojo-attach-point=\"customerGroupSelector\"\r\n                            data-dojo-attach-event='onChange: _onCustomerGroupChanged'></select>\r\n                    <label for=\"markets\">${resources.selectors.market}</label>\r\n                    <select name=\"markets\"\r\n                            data-dojo-type=\"epi-ecf-ui/widget/MarketSelector\"\r\n                            data-dojo-attach-point=\"marketSelector\"\r\n                            data-dojo-attach-event='onChange: _onMarketChanged'></select>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point='priceListNode'></div>\r\n</div>","*now":function(r){r(["dojo/i18n!*preload*epi-ecf-ui/nls/widgets*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);}}});