//>>built
define("epi-ecf-ui/contentediting/viewmodel/_RelationCollectionEditorModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","dojo/_base/json","dojox/html/entities","epi/shell/command/DelegateCommand","epi/shell/widget/dialog/Alert","epi/string","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _2([],{res:null,postscript:function(){this.inherited(arguments);this.own(_5.subscribe("relationChanged",_3.hitch(this,this._refresh)));},generateColumnsDefinition:function(){return {contentTypeIdentifier:{label:"",className:"epi-columnIcon16x16",formatter:_3.hitch(this,_c.contentIcon)},name:{label:this.res.headings.name},path:{label:this.res.headings.path}};},getItemCommands:function(){var _e=this.inherited(arguments);if(_e){for(var i=0;i<_e.length;i++){if(_e[i].name=="remove"){_e[i].iconClass="epi-iconClose";}}}return _e;},getListCommands:function(_f){return [new _9({name:"add",label:this.res.addlabel,tooltip:_d.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:true,delegate:_3.hitch(this,this.addItemDelegate)})];},addItem:function(_10,_11,_12){var _13=this.get("items");if(_13&&_13.length>0){var _14=_10.permanentUrl||_10.target;var _15;_1.some(_13,function(_16){if(_16&&_16.target==_14){_15=_16;return true;}});if(_15){this.moveItem(_15,_11||_15,_12||true);return this._refresh();}}this._setSortOrder(_10,_11,_12);return _6(this.inherited(arguments),_3.hitch(this,function(){return _6(this._store.add(_10),_3.hitch(this,function(){return this._refresh();}),_3.hitch(this,function(_17){return this._showNotification(_17);}));}));},moveItem:function(_18,_19,_1a){return _6(this.inherited(arguments),_3.hitch(this,function(){this._setSortOrder(_18,_19,_1a);return _6(this._store.put(_18),_3.hitch(this,function(){return this._refresh();}),_3.hitch(this,function(_1b){return this._showNotification(_1b);}));}));},removeItem:function(_1c){return _6(this.inherited(arguments),_3.hitch(this,function(){return _6(this._store.remove(_1c.id),_3.hitch(this,function(){return this._refresh();}),_3.hitch(this,function(_1d){return this._showNotification(_1d);}));}));},saveItem:function(_1e,_1f){return _6(this.inherited(arguments),_3.hitch(this,function(){return _6(this._store.put(_1e),_3.hitch(this,function(){return this._refresh();}),_3.hitch(this,function(_20){return this._showNotification(_20);}));}));},_showNotification:function(_21){if(_21.status===400){var _22=new _a({destroyOnHide:true,description:_b.toHTML(_8.encode(_7.fromJson(_21.xhr.responseText))),onAction:_3.hitch(this,function(){this._refresh();})});_22.show();}},_refresh:function(){this.set("data",this.get("data"));},_setSortOrder:function(_23,_24,_25){if(_24){_23.sortOrder=_25?_24.sortOrder:_24.sortOrder+1;}else{var _26=this.get("items");var _27=(_26.length>0)?_26[_26.length-1].sortOrder:0;if(!_23.sortOrder||_27>=_23.sortOrder){_23.sortOrder=_27+100;}}}});});