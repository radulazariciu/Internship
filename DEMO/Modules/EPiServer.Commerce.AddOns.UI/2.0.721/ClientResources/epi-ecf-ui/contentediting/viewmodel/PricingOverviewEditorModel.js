//>>built
define("epi-ecf-ui/contentediting/viewmodel/PricingOverviewEditorModel",["dojo/_base/declare","dojo/_base/lang","dojo/currency","dojo/when","dojo/Stateful","dojo/Evented","dojo/promise/all","epi/shell/_StatefulGetterSetterMixin","epi/shell/command/DelegateCommand","epi/dependency","epi/datetime","epi/i18n!epi/cms/nls/commerce.widget.pricingoverview.grid","epi/i18n!epi/cms/nls/commerce.widget.pricecollection.message"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _1([_5,_8,_6],{_storeKey:"epi.commerce.price",store:null,metadataManager:null,contentLink:null,marketId:null,priceCode:null,queryOptions:null,getChildrenQueryName:"getpricechildren",postscript:function(){this.inherited(arguments);this.storeRegistry=_a.resolve("epi.storeregistry");this.store=this.store||this.storeRegistry.get(this._storeKey);this.metadataManager=this.metadataManager||_a.resolve("epi.shell.MetadataManager");},_createQueryOptions:function(){var _e={referenceId:this.get("contentLink"),query:this.getChildrenQueryName},_f=["query","referenceId"];if(this.get("marketId")){_2.mixin(_e,{marketId:this.get("marketId")});if(_e.marketId==="ALL"){_f.push("marketId");}}if(this.get("priceCode")){_2.mixin(_e,{priceCode:this.get("priceCode")});if(_e.priceCode==="ALL"){_f.push("priceCode");}}return {query:_e,options:{ignore:_f}};},getCommands:function(_10,_11){var _12={category:_11,model:_10,canExecute:true,isAvailable:true};return [new _9(_2.mixin({name:"duplicate",label:_c.commands.duplicate,iconClass:"epi-iconDuplicatePage",delegate:_2.hitch(this,function(cmd){this.emit("duplicateCommandEvent");})},_12)),new _9(_2.mixin({name:"remove",label:_c.commands.remove,iconClass:"epi-iconClose",delegate:_2.hitch(this,function(cmd){this.emit("removeCommandEvent");})},_12))];},addItem:function(_13){return _4(this.store.add(_13),_2.hitch(this,function(_14){this.emit("itemAdded",{id:_14.id});}));},removeItems:function(_15){var _16=[];for(var i=0,j=_15.length;i<j;i+=1){_16.push(this.store.remove(_15[i].id));}return _7(_16).then(_2.hitch(this,function(_17){this.emit("itemsRemoved",{removedItems:data});}));},generateFormatters:function(_18){_18["validDate"].formatter=_2.hitch(this,this._formatValidDate);_18["unitPrice"].formatter=function(_19){return _3.format(_19.amount,{currency:_19.currency});};},_formatValidDate:function(_1a){return this._formatDate(_1a.validFrom)+" - "+this._formatDate(_1a.validUntil);},_formatDate:function(_1b){return _1b&&_1b!==""?_b.toUserFriendlyString(_1b):_d.untildatenotdefined;}});});