//>>built
define("epi-ecf-ui/command/DetachFromCategory",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi-cms/core/ContentReference","../contentediting/ModelSupport","epi/i18n!epi/cms/nls/commerce.command.detachfromcategory"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _2([_9,_a],{label:_f.label,categoryLink:null,iconClass:"epi-iconDetach",_store:null,postscript:function(){this.inherited(arguments);var _10=_8.resolve("epi.storeregistry");this._store=this._store||_10.get("epi.commerce.relation");},_execute:function(){var _11=this.categoryLink||_7(this.model.currentContentService.getCurrentContext(),_3.hitch(this,function(_12){return _12.id;}));var _13=new _d(_11).createVersionUnspecificReference();var _14=_1.map(this.selection.data,function(_15){return _7(this._store.query(this._getQuery(_15.data.contentLink)),_3.hitch(this,function(_16){return _5(_1.map(_16,function(_17){var _18=new _d(_17.target);if(_18.id===_13.id){return this._store.remove(_17.id).then(function(){_6.publish("relationChanged",_17);});}},this));}));},this);_5(_14);},_onModelChange:function(){var _19=[];var _1a=this.selection.data.length>0;_1.forEach(this.selection.data,function(_1b){var _1c=new _4();_19.push(_1c.promise);if(_1b.type!=="epi.cms.contentdata"){_1c.resolve(false);}if(!this.isUsedByCollectionEditor){_7(this.model.currentContentService.getCurrentContext(),_3.hitch(this,function(_1d){if(_d.compareIgnoreVersion(_1b.data.parentLink,_1d.id)){_1c.resolve(false);}}));}_7(this._store.query(this._getQuery(_1b.data.contentLink)),_3.hitch(this,function(_1e){if(this._typeIsAssignableFrom(_1b.data.typeIdentifier,_e.contentTypeIdentifier.nodeContentBase)){_1c.resolve(_1e.length>0);}_1c.resolve(_1e.length>1);}));},this);_5(_19).then(_3.hitch(this,function(_1f){var _20=_1.some(_1f,function(_21){return !_21;});this.set("canExecute",_1a&&!_20);}));},_typeIsAssignableFrom:function(_22,_23){return _b.isBaseTypeIdentifier(_22,_23);},_getQuery:function(_24){return {referenceId:_24,relationTypes:[_e.relationType.node]};}});});