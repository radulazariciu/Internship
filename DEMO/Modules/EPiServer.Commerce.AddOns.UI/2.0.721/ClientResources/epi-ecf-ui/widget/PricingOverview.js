//>>built
require({cache:{"url:epi-ecf-ui/widget/templates/PricingOverview.html":"<div class=\"epi-pricingOverview\">\r\n    <div data-dojo-attach-point=\"header\">\r\n        <div data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-attach-point=\"notificationBar\"></div>\r\n        <div class=\"epi-pricingOverviewEdit\">\r\n            <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n            <div class=\"epi-filterHolder\">\r\n                <div class=\"epi-filterHolderLeading\">\r\n                    <button class=\"epi-mediumButton\"\r\n                            data-dojo-attach-event='onClick: _onAddNewPrice'\r\n                            data-dojo-attach-point=\"addNewPrice\"\r\n                            data-dojo-type=\"dijit/form/Button\"\r\n                            data-dojo-props=\"label: '${resources.buttons.addprice}', title:'${resources.buttons.addprice}', iconClass:'epi-iconPlus'\"></button>\r\n                </div>\r\n                <div class=\"epi-filterHolderCenter clearfix\">\r\n                    <label for=\"customergroup\">${resources.selectors.customergroup}</label>\r\n                    <select name=\"customergroup\"\r\n                            data-dojo-type=\"dijit/form/Select\"\r\n                            data-dojo-attach-point=\"customerGroupSelector\"\r\n                            data-dojo-attach-event='onChange: _onCustomerGroupChanged'></select>\r\n                    <label for=\"markets\">${resources.selectors.market}</label>\r\n                    <select name=\"markets\"\r\n                            data-dojo-type=\"epi-ecf-ui/widget/MarketSelector\"\r\n                            data-dojo-attach-point=\"marketSelector\"\r\n                            data-dojo-attach-event='onChange: _onMarketChanged'></select>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point='priceListNode'></div>\r\n</div>"}});define("epi-ecf-ui/widget/PricingOverview",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/html/entities","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/contentediting/NotificationBar","../contentediting/editors/PricingOverviewEditor","../contentediting/ModelSupport","./BackToPreviousViewNotification","./MarketSelector","./viewmodel/PricingOverviewModel","epi/i18n!epi/cms/nls/commerce.widget.pricingoverview","epi/i18n!epi/cms/nls/commerce.widget.market","epi/i18n!epi/cms/nls/commerce.widget.customergroup","dojo/text!./templates/PricingOverview.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19){return _1([_9,_a,_b,_e],{resources:_16,templateString:_19,modelClassName:_15,defaultCGItem:{id:"ALL",name:_18.defaultitem},_backToPreviousViewNotification:null,modelBindingMap:{"markets":["markets"],"customerGroups":["customerGroups"]},postCreate:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _1a=_1(this.modelClassName);this.set("model",new _1a());}this.model.populateData();this._backToPreviousViewNotification=new _13();this.own(this._backToPreviousViewNotification.watch("notification",_2.hitch(this,this._defaultNotificationWatchHandler)));},buildRendering:function(){this.inherited(arguments);this.priceList=new _11();this.own(this.priceList);_6.place(this.priceList.domNode,this.priceListNode);},showNotification:function(){this._backToPreviousViewNotification.showNotification();},_defaultNotificationWatchHandler:function(_1b,_1c,_1d){if(_1c){this.notificationBar.remove(_1c);}if(_1d&&_1d.content){this.notificationBar.add(_1d);}this.layout();},layout:function(){var _1e=_7.position(dojo.query(".epi-pricingOverview .epi-filterHolder .epi-filterHolderLeading")[0]);var _1f=_7.position(dojo.query(".epi-pricingOverview .epi-filterHolder")[0]);var _20=_7.position(dojo.query(".epi-pricingOverview .epi-filterHolder .epi-filterHolderCenter.clearfix")[0]);var _21=(_1f.w-_1e.w-_20.w)/2+"px";_8.set(dojo.query(".epi-pricingOverview .epi-filterHolder .epi-filterHolderCenter.clearfix")[0],"marginLeft",_21);var _22=_7.getMarginBox(this.header);_7.setMarginBox(this.priceListNode,{h:this._contentBox.h-_22.h,w:this._contentBox.w});},_setCustomerGroupsAttr:function(_23){this.customerGroupSelector._onChangeActive=false;this.customerGroupSelector.removeOption(this.customerGroupSelector.options);if(_23){_23.unshift(this.defaultCGItem);_3.forEach(_23,function(_24){this.customerGroupSelector.addOption({label:_d.encode(_24.name),value:_24.id});},this);}this.customerGroupSelector._onChangeActive=true;},_onMarketChanged:function(){var val=this.marketSelector.value;if(this.priceList.grid){if(val==="ALL"){this.priceList.grid.styleColumn("marketId","display: table-cell;");}else{this.priceList.grid.styleColumn("marketId","display: none;");}}this.priceList.set("marketId",val);},_onAddNewPrice:function(){var _25=this.marketSelector.value;if(_25==="ALL"){_25=null;}var _26=this.customerGroupSelector.value;if(_26==="ALL"){_26=null;}var _27=this.model.getDefaultPrice(_25,_26);this.priceList.addPrice(_27);},_onCustomerGroupChanged:function(){var val=this.customerGroupSelector.value;if(val==="ALL"){this.priceList.grid.styleColumn("priceCode","display: table-cell;");this.priceList.grid.styleColumn("priceType","display: table-cell;");}else{this.priceList.grid.styleColumn("priceCode","display: none;");this.priceList.grid.styleColumn("priceType","display: none;");}this.priceList.set("priceCode",val);},_setValueAttr:function(_28){this.priceList.set("value",_28.id);if(_f.isBaseTypeIdentifier(_28.dataType,_12.contentTypeIdentifier.variationContent)||_f.isBaseTypeIdentifier(_28.dataType,_12.contentTypeIdentifier.packageContent)){_8.set(this.addNewPrice.domNode,"display","");this.model.set("value",_28.id);}else{_8.set(this.addNewPrice.domNode,"display","none");}}});});