//>>built
require({cache:{"url:epi-ecf-ui/widget/templates/CatalogContentList.html":"<div class=\"epi-catalogContentList\">\r\n    <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/StandardToolbar\" class=\"epi-viewHeaderContainer epi-localToolbar\"></div>\r\n    <div class=\"epi-localToolbar epi-flatToolbar\">\r\n        <div class=\"epi-toolbarGroupContainer\">\r\n            <div class=\"epi-toolbarGroup epi-toolbarLeading\" data-dojo-attach-point=\"leadingNode\"></div>\r\n            <div class=\"epi-toolbarGroup epi-toolbarCenter\" data-dojo-attach-point=\"centerNode\"></div>\r\n            <div class=\"epi-toolbarGroup epi-toolbarTrailing\" data-dojo-attach-point=\"trailingNode\">\r\n                <label for=\"markets\">${resources.market}</label>\r\n                <select name=\"markets\" data-dojo-type=\"epi-ecf-ui/widget/MarketSelector\" data-dojo-attach-point=\"marketSelector\" data-dojo-attach-event='onChange: _onMarketChanged' class=\"epi-chromelessSelect epi-flatSelect\"></select>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>"}});define("epi-ecf-ui/widget/CatalogContentList",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/keys","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/html","dojo/on","dojo/topic","dojo/when","dojo/dom-class","dgrid/selector","epi","epi/shell/dgrid/util/misc","epi/dependency","epi/shell/widget/_FocusableMixin","epi/shell/command/builder/ButtonBuilder","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/formatters","epi-cms/widget/_ConfigurableContentListBase","epi-cms/widget/ContentTreeStoreModel","./viewmodel/CatalogContentListViewModel","./CommandToolbar","./MarketSelector","dojo/text!./templates/CatalogContentList.html","epi/i18n!epi/cms/nls/commerce.widget.cataloglist","epi/i18n!epi/cms/nls/commerce.widget.catalogcontentlist"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,on,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,res,_1d){return _3([_17,_12],{resources:_1d,templateString:_1c,_multipleSelectionClassName:"epi-dgrid-multiselect--multiple-selection",storeKeyName:"epi.cms.content.light",contextChangeEvent:"",commandToolbar:null,postCreate:function(){this.inherited(arguments);this.own(this.model.clipboardManager.watch("data",_4.hitch(this,function(_1e,_1f,_20){var _21=this.model.clipboardManager.isCopy(),_22=this.grid;var _23=function(_24,_25){_1.forEach(_24,function(_26){var row;if(_26&&_26.data){var _27=_26.contextId.concat("-",_26.data.contentLink);row=_22.row(_27);if(row&&row.element){_d.toggle(row.element,"epi-opacity50",_25);}}});};if(_1f instanceof Array){_23(_1f,false);}if(!_21&&_20 instanceof Array){_23(_20,true);}})));},startup:function(){this.inherited(arguments);this.grid.set("selectionMode","none");this.grid.dndSource.singular=false;this.own(_b.subscribe("relationChanged",_4.hitch(this,function(){this.grid.refresh();})),_b.subscribe("catalogContentDeleted",_4.hitch(this,function(_28){_c(this.getCurrentContext(),_4.hitch(this,function(_29){var _2a=_1.some(_28,function(_2b){return _14.compareIgnoreVersion(_29.id,_2b.data.parentLink);});if(_2a){this.grid.clearSelection();this.onDeselectedRow();this.grid.refresh();}}));})),_b.subscribe("itemPasted",_4.hitch(this,function(){this.grid.refresh();})));this.grid.on("dgrid-rowcopy",_4.hitch(this,this._onRowCopy));this.grid.on("dgrid-rowcut",_4.hitch(this,this._onRowCut));this.grid.on("dgrid-rowpaste",_4.hitch(this,this._onRowPaste));this.grid.addKeyHandler(_6.ENTER,_4.hitch(this,"_onChangeContext"));this.grid.addKeyHandler(_6.SPACE,_4.hitch(this,function(evt){var row=this.grid.row(evt);if(this.grid.isSelected(row)){this.grid.deselect(row);}else{this.grid.select(row);}}));},_onRowCopy:function(){this.model._commandRegistry.copy.command.execute();},_onRowCut:function(){this.model._commandRegistry.cut.command.execute();},_onRowPaste:function(){this.model._commandRegistry.pasteOnContext.command.execute();},buildRendering:function(){this.baseClass="epi-plain-grid epi-dgrid-multiselect";this.inherited(arguments);var _2c=this.model.getSelectionCommands();this.commandToolbar=new _1a(_2c);this.own(this.commandToolbar);_7.place(this.commandToolbar.domNode,this.leadingNode);this.own(_2.after(this.commandToolbar,"layout",_4.hitch(this,function(){this.resize();})));},resize:function(){this.inherited(arguments);if(this.grid){this.grid.resize();var top=_8.position(this.grid.domNode).y;var _2d=_8.position(_5.body()).h;_9.set(this.grid.domNode,"height",(_2d-top)+"px");}},setupEvents:function(){this.inherited(arguments);this.own(this.grid.on("dgrid-deselect",_4.hitch(this,this.onDeselectedRow)));this.own(this.grid.on(".epi-iconContextMenu:click",_4.hitch(this,this.onContextMenuClick)));for(var _2e in this.getColumnSettings()){if(_2e=="checkbox"){this.own(this.grid.on(".dgrid-cell.dgrid-column-"+_2e+":mousedown",_4.hitch(this,function(e){this._isColumnDraggable=false;})),on(this.grid.domNode,"mouseup",_4.hitch(this,function(e){this._isColumnDraggable=true;})));continue;}this.own(this.grid.on(".dgrid-cell.dgrid-column-"+_2e+":click",_4.hitch(this,"_onChangeContext")));}var _2f=this;_2.around(this.grid.dndSource,"onMouseMove",function(_30){return function(e){if(!_2f._isColumnDraggable){return;}return _30.call(_2f.grid.dndSource,e);};});},onDeselectedRow:function(){var _31=[];for(var id in this.grid.selection){var row=this.grid.row(id);_31.push(row.data);}this.model.updateSelection(_31);this._removeContextMenuWhenRowIsSelected();},getListSettings:function(){var _32=this.inherited(arguments);return _4.mixin(_32,{cellNavigation:false});},_onSelect:function(){this.inherited(arguments);this._removeContextMenuWhenRowIsSelected();},_removeContextMenuWhenRowIsSelected:function(){_d.remove(this.grid.contentNode,this._multipleSelectionClassName);if(this.model.numSelectedRows>0){_d.add(this.grid.contentNode,this._multipleSelectionClassName);}},onContextMenuClick:function(e){var row=this.grid.row(e);this.model.set("model",{data:[row.data]});_1.forEach(this.grid.contextMenu.getChildren(),function(_33,i){if(_33.arrowWrapper&&_33.popup){_9.set(_33.arrowWrapper,"visibility","");}});this.grid.clearSelection();this.grid.select(row);},createModel:function(){return new _19();},fetchData:function(_34){this._setGridQuery(_34.id);_c(this.store.get(_34.id),_4.hitch(this,function(_35){this.onDeselectedRow();var _36=this.model._commandRegistry.pasteOnContext.command;_36.selection.set("data",[{type:"epi.cms.contentdata",data:_35}]);}));},_setGridQuery:function(id){var _37={ignore:["query"],parentId:id,sort:[{attribute:"typeSortIndex"}]};var _38={referenceId:id,query:"getchildren",market:this.marketSelector.value,includeProperties:true,allLanguages:true};this.grid.set("query",_38,_37);},getColumnSettings:function(){return {checkbox:_e({label:"",selectorType:"checkbox",className:"epi-columnVeryNarrow"}),typeSortIndex:{renderHeaderCell:function(_39){},get:function(_3a){return _3a.typeIdentifier;},formatter:_16.contentIcon,className:"epi-columnIcon16x16"},name:{label:_f.resources.header.name,className:"epi-columnWide"},code:{get:function(_3b){return _3b.properties.code;},label:res.code},price:{get:function(_3c){return _3c.properties.price;},label:res.price,sortable:false},stock:{get:function(_3d){return {count:_3d.properties.inStockQuantity,status:_3d.properties.inStockStatus};},label:res.stock,formatter:this._getStockElement,sortable:false},isPendingPublish:{get:function(_3e){return _3e.status==_15.versionStatus.Published;},label:res.active,formatter:_16.friendlyBoolean,className:"epi-columnNarrow"},startPublish:{get:function(_3f){return _3f.properties.startPublish;},label:res.availablefrom,formatter:this._localizedDateAndSecondaryText},stopPublish:{get:function(_40){return _40.properties.stopPublish;},label:_f.resources.header.expires,formatter:this._localizedDateAndSecondaryText},metaClassName:{get:function(_41){return _41.properties.metaClassName;},label:res.producttype,formatter:_16.secondaryText}};},_getStockElement:function(_42){if(_42.count===undefined||_42.count===null){return "";}var _43="epi-stock-"+_42.status;return "<span class=\"epi-stock "+_43+"\">"+_42.count+_10.icon("epi-iconBoxes")+"</span>";},_localizedDateAndSecondaryText:function(_44){return _16.secondaryText(_16.localizedDate(_44),true);},_onMarketChanged:function(){if(!this.grid){return;}var _45=this.grid.get("queryOptions");if(_45){this._setGridQuery(_45.parentId);}}});});